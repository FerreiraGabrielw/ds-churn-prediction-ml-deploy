<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gabriel Ferreira">
<meta name="dcterms.date" content="2026-02-28">

<title>Customer Churn Analysis and Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="ProjetoChurn_files/libs/clipboard/clipboard.min.js"></script>
<script src="ProjetoChurn_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="ProjetoChurn_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="ProjetoChurn_files/libs/quarto-html/popper.min.js"></script>
<script src="ProjetoChurn_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="ProjetoChurn_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ProjetoChurn_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ProjetoChurn_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ProjetoChurn_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ProjetoChurn_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#project-structure" id="toc-project-structure" class="nav-link" data-scroll-target="#project-structure">Project Structure</a></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">Data Preprocessing</a></li>
  <li><a href="#building-and-evaluating-machine-learning-models" id="toc-building-and-evaluating-machine-learning-models" class="nav-link" data-scroll-target="#building-and-evaluating-machine-learning-models">Building and Evaluating Machine Learning Models</a></li>
  <li><a href="#comparison-of-model-performance-metrics" id="toc-comparison-of-model-performance-metrics" class="nav-link" data-scroll-target="#comparison-of-model-performance-metrics">Comparison of Model Performance Metrics</a></li>
  <li><a href="#feature-importance" id="toc-feature-importance" class="nav-link" data-scroll-target="#feature-importance">Feature Importance</a></li>
  <li><a href="#recommendations-and-business-actions-based-on-insights" id="toc-recommendations-and-business-actions-based-on-insights" class="nav-link" data-scroll-target="#recommendations-and-business-actions-based-on-insights">Recommendations and Business Actions Based on Insights:</a></li>
  <li><a href="#deploy" id="toc-deploy" class="nav-link" data-scroll-target="#deploy">Deploy</a></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Customer Churn Analysis and Prediction</h1>
</div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gabriel Ferreira </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 28, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The objective of this project is to analyze and build a Machine Learning model based on customer churn data. The dataset contains information about a fictional telecommunications company that provided landline phone and internet services to 7,043 customers in California in the third quarter. It indicates which customers left, stayed, or signed up for their service. Churn prediction identifies customers who are likely to cancel their contracts soon. If the company can do this, it can address the users before churn.</p>
<p>The target variable we want to predict is categorical and has only two possible outcomes: churn or non-churn (Binary Classification). We would also like to understand why the model thinks our customers are leaving, and for that, we need to be able to interpret the model’s predictions. According to the description, this dataset contains the following information:</p>
<ul>
<li>Customer services: phone; multiple lines; internet; tech support and extra services, such as online security, backup, device protection, and TV streaming</li>
<li>Account information: how long they’ve been a customer, contract type, payment method type</li>
<li>Charges: how much was charged to the customer last month and in total</li>
<li>Demographic information: gender, age, and whether they have dependents or a partner</li>
<li>Churn: yes/no, whether the customer left the company last month</li>
</ul>
</section>
<section id="project-structure" class="level1">
<h1>Project Structure</h1>
<p>The development of this project followed a structured and iterative methodology, covering everything from data collection and preparation to the evaluation and interpretation of results.</p>
</section>
<section id="exploratory-data-analysis-eda" class="level1">
<h1>Exploratory Data Analysis (EDA)</h1>
<section id="columns" class="level6">
<h6 data-anchor-id="columns">Columns:</h6>
<div id="ace583f8" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>Index(['customerID', 'gender', 'SeniorCitizen', 'Partner', 'Dependents',
       'tenure', 'PhoneService', 'MultipleLines', 'InternetService',
       'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', 'TechSupport',
       'StreamingTV', 'StreamingMovies', 'Contract', 'PaperlessBilling',
       'PaymentMethod', 'MonthlyCharges', 'TotalCharges', 'Churn'],
      dtype='object')</code></pre>
</div>
</div>
</section>
<section id="sample" class="level6">
<h6 data-anchor-id="sample">Sample:</h6>
<div id="f3c71ae1" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customerID</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">DeviceProtection</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">908</td>
<td>4694-PHWFW</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>Yes</td>
<td>8</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Month-to-month</td>
<td>No</td>
<td>Mailed check</td>
<td>19.95</td>
<td>170.9</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4138</td>
<td>5597-GLBUC</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>...</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>85.45</td>
<td>85.45</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5134</td>
<td>8010-EZLOU</td>
<td>Male</td>
<td>1</td>
<td>No</td>
<td>No</td>
<td>15</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>No</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>80.20</td>
<td>1217.25</td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4027</td>
<td>5590-YRFJT</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>20</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>No</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>24.45</td>
<td>482.8</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4977</td>
<td>6527-PZFPV</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>24</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>One year</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>20.80</td>
<td>469.65</td>
<td>No</td>
</tr>
</tbody>
</table>

<p>5 rows × 21 columns</p>
</div>
</div>
</div>
</section>
<section id="info" class="level6">
<h6 data-anchor-id="info">Info:</h6>
<div id="5938c193" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 7043 entries, 0 to 7042
Data columns (total 21 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   customerID        7043 non-null   object 
 1   gender            7043 non-null   object 
 2   SeniorCitizen     7043 non-null   int64  
 3   Partner           7043 non-null   object 
 4   Dependents        7043 non-null   object 
 5   tenure            7043 non-null   int64  
 6   PhoneService      7043 non-null   object 
 7   MultipleLines     7043 non-null   object 
 8   InternetService   7043 non-null   object 
 9   OnlineSecurity    7043 non-null   object 
 10  OnlineBackup      7043 non-null   object 
 11  DeviceProtection  7043 non-null   object 
 12  TechSupport       7043 non-null   object 
 13  StreamingTV       7043 non-null   object 
 14  StreamingMovies   7043 non-null   object 
 15  Contract          7043 non-null   object 
 16  PaperlessBilling  7043 non-null   object 
 17  PaymentMethod     7043 non-null   object 
 18  MonthlyCharges    7043 non-null   float64
 19  TotalCharges      7043 non-null   object 
 20  Churn             7043 non-null   object 
dtypes: float64(1), int64(2), object(18)
memory usage: 1.1+ MB</code></pre>
</div>
</div>
<p>The column TotalCharges is currently an object and needs to be converted to a numeric type. ###### Info:</p>
<div id="d9dd6c94" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalCharges'</span>] <span class="op">=</span> pd.to_numeric(df[<span class="st">'TotalCharges'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="describe" class="level6">
<h6 data-anchor-id="describe">Describe:</h6>
<div id="ae8be71d" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>7043.000000</td>
<td>7043.000000</td>
<td>7043.000000</td>
<td>7032.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.162147</td>
<td>32.371149</td>
<td>64.761692</td>
<td>2283.300441</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.368612</td>
<td>24.559481</td>
<td>30.090047</td>
<td>2266.771362</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000000</td>
<td>18.250000</td>
<td>18.800000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.000000</td>
<td>9.000000</td>
<td>35.500000</td>
<td>401.450000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.000000</td>
<td>29.000000</td>
<td>70.350000</td>
<td>1397.475000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.000000</td>
<td>55.000000</td>
<td>89.850000</td>
<td>3794.737500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.000000</td>
<td>72.000000</td>
<td>118.750000</td>
<td>8684.800000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="checking-missing-values" class="level6">
<h6 data-anchor-id="checking-missing-values">Checking Missing Values:</h6>
<div id="353d3d1a" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.isnull().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>customerID           0
gender               0
SeniorCitizen        0
Partner              0
Dependents           0
tenure               0
PhoneService         0
MultipleLines        0
InternetService      0
OnlineSecurity       0
OnlineBackup         0
DeviceProtection     0
TechSupport          0
StreamingTV          0
StreamingMovies      0
Contract             0
PaperlessBilling     0
PaymentMethod        0
MonthlyCharges       0
TotalCharges        11
Churn                0
dtype: int64</code></pre>
</div>
</div>
<p>The TotalCharges column has 11 missing values. Let’s analyze it to define the best strategy to handle them.</p>
</section>
<section id="displaying-the-full-rows-with-missing-value" class="level6">
<h6 data-anchor-id="displaying-the-full-rows-with-missing-value">Displaying the Full Rows with Missing Value:</h6>
<div id="2da2d395" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'TotalCharges'</span>].isna()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customerID</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">DeviceProtection</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">488</td>
<td>4472-LVYGI</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>52.55</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">753</td>
<td>3115-CZMZD</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>20.25</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">936</td>
<td>5709-LVOEQ</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>80.85</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1082</td>
<td>4367-NUYAO</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>25.75</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1340</td>
<td>1371-DWPAZ</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>56.05</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3331</td>
<td>7644-OMVMY</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>19.85</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3826</td>
<td>3213-VVOLG</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>25.35</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4380</td>
<td>2520-SGTTA</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>20.00</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5218</td>
<td>2923-ARZLG</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>One year</td>
<td>Yes</td>
<td>Mailed check</td>
<td>19.70</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6670</td>
<td>4075-WKNIU</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>DSL</td>
<td>No</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>73.35</td>
<td>NaN</td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6754</td>
<td>2775-SEFEE</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>61.90</td>
<td>NaN</td>
<td>No</td>
</tr>
</tbody>
</table>

<p>11 rows × 21 columns</p>
</div>
</div>
</div>
<p>We observe that the rows with missing TotalCharges have a tenure of 0. This means they are new customers who haven’t accumulated any charges yet. Therefore, we will impute these missing values with 0.</p>
</section>
<section id="filling-the-missing-values-with-0" class="level6">
<h6 data-anchor-id="filling-the-missing-values-with-0">Filling the missing values with 0:</h6>
<div id="2db41dce" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalCharges'</span>] <span class="op">=</span> df[<span class="st">'TotalCharges'</span>].fillna(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="checking-missing-values-again" class="level6">
<h6 data-anchor-id="checking-missing-values-again">Checking Missing Values Again:</h6>
<div id="8860096b" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>customerID          0
gender              0
SeniorCitizen       0
Partner             0
Dependents          0
tenure              0
PhoneService        0
MultipleLines       0
InternetService     0
OnlineSecurity      0
OnlineBackup        0
DeviceProtection    0
TechSupport         0
StreamingTV         0
StreamingMovies     0
Contract            0
PaperlessBilling    0
PaymentMethod       0
MonthlyCharges      0
TotalCharges        0
Churn               0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="totalcharges-distribution" class="level6">
<h6 data-anchor-id="totalcharges-distribution">TotalCharges Distribution:</h6>
<div id="def40ab7" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"TotalCharges"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data <span class="op">=</span> df[<span class="st">'TotalCharges'</span>], color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-13-output-1.png" width="527" height="487" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="univariate-analysis" class="level2">
<h2 data-anchor-id="univariate-analysis">Univariate Analysis</h2>
<section id="totalcharges" class="level6">
<h6 data-anchor-id="totalcharges">TotalCharges:</h6>
<div id="34179390" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'TotalCharges Analysis'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df[<span class="st">'TotalCharges'</span>], color<span class="op">=</span><span class="st">'blue'</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Boxplot'</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'TotalCharges'</span>], color<span class="op">=</span><span class="st">'red'</span>, kde<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'TotalCharges Distribution'</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-14-output-1.png" width="757" height="459" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="monthlycharges" class="level6">
<h6 data-anchor-id="monthlycharges">MonthlyCharges:</h6>
<div id="fcfd8009" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'MonthlyCharges Analysis'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df[<span class="st">'MonthlyCharges'</span>], color<span class="op">=</span><span class="st">'blue'</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Boxplot'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'MonthlyCharges'</span>], color<span class="op">=</span><span class="st">'red'</span>, kde<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'MonthlyCharges Distribution'</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-15-output-1.png" width="756" height="459" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tenure" class="level6">
<h6 data-anchor-id="tenure">Tenure:</h6>
<div id="705f7206" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Tenure Analysis'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>df[<span class="st">'tenure'</span>], color<span class="op">=</span><span class="st">'blue'</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'Boxplot'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'tenure'</span>], color<span class="op">=</span><span class="st">'red'</span>, kde<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'Tenure Distribution'</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Density'</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-16-output-1.png" width="757" height="459" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We are going to replace ‘No internet service’ and ‘No phone service’ with ‘No’. This is because they carry the same meaning (the customer does not have that particular service), and keeping them as separate categories would create unnecessary features without adding relevant information for the model.</p>
</section>
<section id="replacing-these-values-with-no-across-the-dataframe" class="level6">
<h6 data-anchor-id="replacing-these-values-with-no-across-the-dataframe">Replacing these values with “No” across the DataFrame:</h6>
<div id="66269539" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>valores_substituir <span class="op">=</span> [<span class="st">"No internet service"</span>, <span class="st">"No phone service"</span>]</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.replace(valores_substituir, <span class="st">"No"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s analyze the churn rate across our categorical variables, comparing the rate for each category against the global average churn rate</p>
</section>
<section id="creating-visuals" class="level6">
<h6 data-anchor-id="creating-visuals">Creating Visuals:</h6>
<div id="f02d6a0c" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df_copy <span class="op">=</span> df.copy()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df_copy[<span class="st">'Churn'</span>] <span class="op">=</span> df_copy[<span class="st">'Churn'</span>].<span class="bu">map</span>({<span class="st">'No'</span>: <span class="dv">0</span>, <span class="st">'Yes'</span>: <span class="dv">1</span>})</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender'</span>, <span class="st">'MultipleLines'</span>, <span class="st">'InternetService'</span>, <span class="st">'OnlineSecurity'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'OnlineBackup'</span>, <span class="st">'DeviceProtection'</span>, <span class="st">'TechSupport'</span>, <span class="st">'StreamingTV'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'StreamingMovies'</span>, <span class="st">'Contract'</span>, <span class="st">'PaperlessBilling'</span>, <span class="st">'PaymentMethod'</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>global_mean <span class="op">=</span> df_copy[<span class="st">'Churn'</span>].mean()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Global Mean Churn Rate: </span><span class="sc">{</span>global_mean<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>n_features <span class="op">=</span> <span class="bu">len</span>(categorical_features)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>ncols <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>nrows <span class="op">=</span> (n_features <span class="op">+</span> ncols <span class="op">-</span> <span class="dv">1</span>) <span class="op">//</span> ncols</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows, ncols, figsize<span class="op">=</span>(<span class="dv">8</span>, nrows <span class="op">*</span> <span class="dv">5</span>), constrained_layout<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten() <span class="cf">if</span> <span class="bu">isinstance</span>(axes, (<span class="bu">list</span>, np.ndarray)) <span class="cf">else</span> [axes]</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, feature <span class="kw">in</span> <span class="bu">enumerate</span>(categorical_features):</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    df_group <span class="op">=</span> df_copy.groupby(by<span class="op">=</span>feature)[<span class="st">'Churn'</span>].agg([<span class="st">'mean'</span>]).reset_index()</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i]</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    graph <span class="op">=</span> sns.barplot(x<span class="op">=</span>feature, y<span class="op">=</span><span class="st">'mean'</span>, data<span class="op">=</span>df_group, palette<span class="op">=</span><span class="st">'viridis'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    ax.axhline(global_mean, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    ax.text(<span class="dv">0</span>, global_mean <span class="op">+</span> <span class="fl">0.01</span>, <span class="ss">f"Global Mean: </span><span class="sc">{</span>global_mean<span class="sc">:.2f}</span><span class="ss">"</span>, color<span class="op">=</span><span class="st">'red'</span>, weight<span class="op">=</span><span class="st">'semibold'</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"Churn Rate by </span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">"Mean Churn Rate"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">""</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="dv">0</span>, <span class="bu">max</span>(df_group[<span class="st">'mean'</span>].<span class="bu">max</span>() <span class="op">*</span> <span class="fl">1.2</span>, global_mean <span class="op">*</span> <span class="fl">1.2</span>))</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, labelrotation<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i <span class="op">+</span> <span class="dv">1</span>, <span class="bu">len</span>(axes)):</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    axes[j].axis(<span class="st">'off'</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Global Mean Churn Rate: 0.27</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-18-output-2.png" width="779" height="5771" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="bivariate-analysis" class="level2">
<h2 data-anchor-id="bivariate-analysis">Bivariate Analysis</h2>
<section id="monthlycharges-x-churn" class="level6">
<h6 data-anchor-id="monthlycharges-x-churn">MonthlyCharges x Churn:</h6>
<div id="cacf504b" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'MonthlyCharges'</span>, hue<span class="op">=</span><span class="st">'Churn'</span>, fill<span class="op">=</span><span class="va">True</span>, common_norm<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'mako'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-19-output-1.png" width="692" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="totalcharges-x-churn" class="level6">
<h6 data-anchor-id="totalcharges-x-churn">TotalCharges x Churn:</h6>
<div id="770aa1b3" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'TotalCharges'</span>, hue<span class="op">=</span><span class="st">'Churn'</span>, fill<span class="op">=</span><span class="va">True</span>, common_norm<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'mako'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-20-output-1.png" width="689" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tenure-x-churn" class="level6">
<h6 data-anchor-id="tenure-x-churn">Tenure x Churn:</h6>
<div id="1d4318d1" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>df, x<span class="op">=</span><span class="st">'tenure'</span>, hue<span class="op">=</span><span class="st">'Churn'</span>, fill<span class="op">=</span><span class="va">True</span>, common_norm<span class="op">=</span><span class="va">False</span>, palette<span class="op">=</span><span class="st">'mako'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-21-output-1.png" width="680" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="inights" class="level3">
<h3 data-anchor-id="inights">Inights</h3>
<p>The average churn rate found in the dataset is approximately 27%, meaning that roughly one in every four customers terminates their contract. This is a significant rate and should be treated as a critical retention indicator. An analysis of the tenure variable shows a median of 29 months, but with 25% of customers staying for nine months or less, revealing a high concentration of short-term customers and suggesting that early churn is a primary risk.</p>
<p>Regarding billing, the MonthlyCharges variable has a mean of around 64.8 but with a wide spread, indicating highly distinct consumption profiles. TotalCharges, in turn, reflects both the variation in contract length and the accumulation of spending over time.</p>
<p>Observing the categorical variables, it’s notable that customers on month-to-month contracts, those who use paperless billing, and those with certain payment methods exhibit churn rates higher than the global average. These profiles, therefore, constitute strategic targets for targeted interventions. It is also worth highlighting that the data handling applied to TotalCharges was essential to prevent distortions and ensure consistency in the comparisons made.</p>
<p>The relationship between churn and tenure reveals that customers who cancel tend to be concentrated in the first few months of their contract, reinforcing the need for specific onboarding and loyalty strategies in the very first cycles. The comparison between churn and MonthlyCharges indicates that there are billing ranges in which the propensity to cancel is higher, especially among customers with higher invoice values, which suggests a need to evaluate the perceived cost-benefit in this segment.</p>
</section>
</section>
</section>
<section id="data-preprocessing" class="level1">
<h1>Data Preprocessing</h1>
<section id="dropping-the-customerid-column-as-it-has-no-predictive-value" class="level6">
<h6 data-anchor-id="dropping-the-customerid-column-as-it-has-no-predictive-value">Dropping the customerID column as it has no predictive value:</h6>
<div id="b2046944" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'customerID'</span>, axis<span class="op">=</span><span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="describe-current-df" class="level6">
<h6 data-anchor-id="describe-current-df">Describe current df:</h6>
<div id="d7bc2930" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df.describe(include<span class="op">=</span>[<span class="st">'object'</span>, <span class="st">'bool'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">OnlineBackup</th>
<th data-quarto-table-cell-role="th">DeviceProtection</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">Churn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
<td>7043</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>Male</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>3555</td>
<td>3641</td>
<td>4933</td>
<td>6361</td>
<td>4072</td>
<td>3096</td>
<td>5024</td>
<td>4614</td>
<td>4621</td>
<td>4999</td>
<td>4336</td>
<td>4311</td>
<td>3875</td>
<td>4171</td>
<td>2365</td>
<td>5174</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="label-encoding-for-binary-variables" class="level6">
<h6 data-anchor-id="label-encoding-for-binary-variables">Label Encoding for binary variables:</h6>
<div id="ede8a9c1" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>binarias <span class="op">=</span> [</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender'</span>, <span class="st">'Partner'</span>, <span class="st">'Dependents'</span>, <span class="st">'PhoneService'</span>, <span class="st">'MultipleLines'</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'OnlineSecurity'</span>, <span class="st">'OnlineBackup'</span>, <span class="st">'DeviceProtection'</span>, <span class="st">'TechSupport'</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'StreamingTV'</span>, <span class="st">'StreamingMovies'</span>, <span class="st">'PaperlessBilling'</span>, <span class="st">'Churn'</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping Yes/No to 1/0 and Male/Female to 1/0</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>mapeamento <span class="op">=</span> {<span class="st">'Yes'</span>: <span class="dv">1</span>,<span class="st">'No'</span>: <span class="dv">0</span>,<span class="st">'Male'</span>: <span class="dv">1</span>,<span class="st">'Female'</span>: <span class="dv">0</span>}</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> binarias:</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> df[col].<span class="bu">map</span>(mapeamento)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="one-hot-encoding-for-nominal-variable" class="level6">
<h6 data-anchor-id="one-hot-encoding-for-nominal-variable">One-Hot Encoding for nominal variable:</h6>
<div id="ced0675c" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>nominais <span class="op">=</span> [<span class="st">'InternetService'</span>, <span class="st">'Contract'</span>, <span class="st">'PaymentMethod'</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(df, columns<span class="op">=</span>nominais, drop_first<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="correlation-analysis-of-numerical-variables" class="level6">
<h6 data-anchor-id="correlation-analysis-of-numerical-variables">Correlation Analysis of Numerical Variables:</h6>
<div id="60c0c86c" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df[[<span class="st">'tenure'</span>, <span class="st">'MonthlyCharges'</span>, <span class="st">'TotalCharges'</span>, <span class="st">'Churn'</span>]].corr(), annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-26-output-1.png" width="640" height="416" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="correlation-analysis-with-the-churn-column" class="level6">
<h6 data-anchor-id="correlation-analysis-with-the-churn-column">Correlation Analysis with the ‘Churn’ Column:</h6>
<div id="8a7afa02" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> df.corr()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>corr_churn <span class="op">=</span> corr_matrix[<span class="st">'Churn'</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(corr_churn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Churn                                    1.000000
InternetService_Fiber optic              0.308020
PaymentMethod_Electronic check           0.301919
MonthlyCharges                           0.193356
PaperlessBilling                         0.191825
SeniorCitizen                            0.150889
StreamingTV                              0.063228
StreamingMovies                          0.061382
MultipleLines                            0.040102
PhoneService                             0.011942
gender                                  -0.008612
DeviceProtection                        -0.066160
OnlineBackup                            -0.082255
PaymentMethod_Mailed check              -0.091683
PaymentMethod_Credit card (automatic)   -0.134302
Partner                                 -0.150448
Dependents                              -0.164221
TechSupport                             -0.164674
OnlineSecurity                          -0.171226
Contract_One year                       -0.177820
TotalCharges                            -0.198324
InternetService_No                      -0.227890
Contract_Two year                       -0.302253
tenure                                  -0.352229
Name: Churn, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="correlation-matrix" class="level6">
<h6 data-anchor-id="correlation-matrix">Correlation Matrix:</h6>
<div id="37b7f495" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> df.corr()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>limite <span class="op">=</span> <span class="fl">0.7</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>corr_pairs <span class="op">=</span> (</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    corr_matrix.where(np.triu(np.ones(corr_matrix.shape), k<span class="op">=</span><span class="dv">1</span>).astype(<span class="bu">bool</span>))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    .stack()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>corr_pairs.columns <span class="op">=</span> [<span class="st">'Var1'</span>, <span class="st">'Var2'</span>, <span class="st">'Correlation'</span>]</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>corr_high <span class="op">=</span> corr_pairs[<span class="bu">abs</span>(corr_pairs[<span class="st">'Correlation'</span>]) <span class="op">&gt;</span> limite].sort_values(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">'Correlation'</span>, ascending<span class="op">=</span><span class="va">False</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Highly correlated variables (|correlation| &gt; 0.7):"</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(corr_high)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>corr_filtrada <span class="op">=</span> corr_matrix.mask(<span class="bu">abs</span>(corr_matrix) <span class="op">&lt;=</span> limite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Highly correlated variables (|correlation| &gt; 0.7):
               Var1                         Var2  Correlation
96           tenure                 TotalCharges     0.826178
233  MonthlyCharges  InternetService_Fiber optic     0.787066
234  MonthlyCharges           InternetService_No    -0.763557</code></pre>
</div>
</div>
<p>The 0.826 correlation between tenure and TotalCharges is extremely high, indicating strong multicollinearity. TotalCharges is fundamentally the product of tenure and MonthlyCharges (or, more precisely, the sum of MonthlyCharges over the tenure). Keeping all three variables together would add redundancy and could complicate interpretability, especially for linear models, without necessarily adding more predictive power.</p>
<p>We opted to remove TotalCharges, as we still retain crucial information from tenure (the customer’s length of stay, a key indicator of loyalty and maturity) and MonthlyCharges (the current cost of service, which correlates with the quality/service package and is a strong predictor of churn). Together, these two variables already capture the essence of what TotalCharges represents.</p>
<p>The other strong correlations reflect the intrinsic business relationship between the service value (MonthlyCharges) and the service type (InternetService). Removing either of these variables would mean losing valuable information about the customer’s service package, which is a very strong predictor of churn. The Machine Learning model can and should use this information to learn the relationship. The multicollinearity here is more of a reflection that one variable (MonthlyCharges) is heavily influenced by another (InternetService), and both are relevant.</p>
</section>
<section id="dropping-the-totalcharges-column" class="level6">
<h6 data-anchor-id="dropping-the-totalcharges-column">Dropping the TotalCharges column:</h6>
<div id="91599c38" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(<span class="st">'TotalCharges'</span>, axis<span class="op">=</span><span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="distribution-of-the-target-variable" class="level6">
<h6 data-anchor-id="distribution-of-the-target-variable">Distribution of the Target Variable:</h6>
<div id="7a7a9f48" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>churn_counts <span class="op">=</span> df[<span class="st">'Churn'</span>].value_counts()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Churn Count:"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(churn_counts)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>plt.pie(</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    churn_counts, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'No (0)'</span>, <span class="st">'Yes (1)'</span>],   </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    autopct<span class="op">=</span><span class="st">'</span><span class="sc">%1.1f%%</span><span class="st">'</span>, </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    startangle<span class="op">=</span><span class="dv">90</span>, </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    colors<span class="op">=</span>[<span class="st">'#1f77b4'</span>, <span class="st">'#ff7f0e'</span>],</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    explode<span class="op">=</span>(<span class="dv">0</span>,<span class="fl">0.05</span>),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    shadow<span class="op">=</span><span class="va">True</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Churn Distribution (%)"</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>plt.show() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Churn Count:
Churn
0    5174
1    1869
Name: count, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-30-output-2.png" width="463" height="483" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We are facing a class imbalance problem in our target variable. To address this, we will test different strategies and approaches to determine which one yields the best model. Our objective is to build a model with an accuracy above 80%.</p>
<p>Why Recall? In the context of customer churn prediction, Recall (also known as Sensitivity or True Positive Rate) is the primary metric to optimize. It measures our model’s ability to correctly identify the highest possible proportion of customers who will actually leave the company (the “Churn” minority class).</p>
<p>Minimizing Customer Losses (False Negatives): The cost of a False Negative (a customer the model predicted would not churn, but who actually did) is typically very high for a business. Each lost customer represents not only the interruption of future revenue but also the potential loss of Lifetime Value (LTV), the costs of acquiring new customers, and a negative impact on reputation. A high Recall means we are minimizing these False Negatives, ensuring that most customers at risk of churning are flagged for intervention.</p>
<p>Opportunity for Proactive Intervention: By identifying a customer with a high probability of churning (thanks to a high Recall), the company gains the opportunity to implement targeted retention strategies (personalized offers, proactive support, satisfaction surveys). Missing this opportunity due to a False Negative is the most costly error in this scenario.</p>
<p>Although Recall is the priority, we do not disregard Precision, F1-Score, and AUC-ROC:</p>
<p>In summary, our focus is to ensure that the largest possible number of at-risk customers are identified (high Recall), enabling effective retention actions. The other metrics help us refine the model, ensuring that these interventions are as efficient and targeted as possible, thus optimizing the return on investment (ROI) in churn prevention.</p>
</section>
<section id="separating-features-x-and-target-variable-y" class="level6">
<h6 data-anchor-id="separating-features-x-and-target-variable-y">Separating Features (X) and Target Variable (y):</h6>
<div id="6f9a6698" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(<span class="st">'Churn'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">'Churn'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="splitting-data-into-train-and-test" class="level6">
<h6 data-anchor-id="splitting-data-into-train-and-test">Splitting data into train and test:</h6>
<div id="eb7529ef" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="scaling-numerical-variables" class="level6">
<h6 data-anchor-id="scaling-numerical-variables">Scaling Numerical Variables:</h6>
<div id="ee6086a5" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> [<span class="st">'tenure'</span>, <span class="st">'MonthlyCharges'</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>X_train[numeric_cols] <span class="op">=</span> scaler.fit_transform(X_train[numeric_cols])</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>X_test[numeric_cols] <span class="op">=</span> scaler.transform(X_test[numeric_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualizing-the-variables-after-scaling" class="level6">
<h6 data-anchor-id="visualizing-the-variables-after-scaling">Visualizing the variables after scaling:</h6>
<div id="ae308abb" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="op">=</span> [<span class="st">"tenure"</span>, <span class="st">'MonthlyCharges'</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feat <span class="kw">in</span> numeric_cols:</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>)) </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    sns.histplot(data<span class="op">=</span>X_train, x<span class="op">=</span>feat, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'</span><span class="sc">{</span>feat<span class="sc">}</span><span class="ss"> Distribution'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-34-output-1.png" width="676" height="451" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-34-output-2.png" width="676" height="451" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="building-and-evaluating-machine-learning-models" class="level1">
<h1>Building and Evaluating Machine Learning Models</h1>
<section id="logistic-regression" class="level2">
<h2 data-anchor-id="logistic-regression">Logistic Regression:</h2>
<div id="7b756220" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>log_reg_model <span class="op">=</span> LogisticRegression(class_weight<span class="op">=</span><span class="st">'balanced'</span>, solver<span class="op">=</span><span class="st">'liblinear'</span>, random_state<span class="op">=</span><span class="dv">42</span>, max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>log_reg_model.fit(X_train, y_train)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>y_pred_log_reg <span class="op">=</span> log_reg_model.predict(X_test)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>y_proba_log_reg <span class="op">=</span> log_reg_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Logistic Regression) ---"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_log_reg))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>cm_log_reg <span class="op">=</span> confusion_matrix(y_test, y_pred_log_reg)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_log_reg, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Real'</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predict'</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix'</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co"># AUC-ROC</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>auc_log_reg <span class="op">=</span> roc_auc_score(y_test, y_proba_log_reg)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (Logistic Regression): </span><span class="sc">{</span>auc_log_reg<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotar Curva ROC</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(log_reg_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'Logistic Regression'</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - (Logistic Regression)'</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Classification Report (Logistic Regression) ---
              precision    recall  f1-score   support

           0       0.90      0.73      0.81      1035
           1       0.51      0.78      0.62       374

    accuracy                           0.74      1409
   macro avg       0.70      0.75      0.71      1409
weighted avg       0.80      0.74      0.76      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-35-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (Logistic Regression): 0.8389</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-35-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="random-forest" class="level2">
<h2 data-anchor-id="random-forest">Random Forest:</h2>
<div id="8e7eac4d" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> RandomForestClassifier(class_weight<span class="op">=</span><span class="st">'balanced'</span>, random_state<span class="op">=</span><span class="dv">42</span>, n_estimators<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>rf_model.fit(X_train, y_train)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>y_pred_rf <span class="op">=</span> rf_model.predict(X_test)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>y_proba_rf <span class="op">=</span> rf_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Random Forest) ---"</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_rf))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>cm_rf <span class="op">=</span> confusion_matrix(y_test, y_pred_rf)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_rf, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Real'</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predict'</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - Random Forest'</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular e exibir AUC-ROC</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>auc_rf <span class="op">=</span> roc_auc_score(y_test, y_proba_rf)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (Random Forest): </span><span class="sc">{</span>auc_rf<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotar Curva ROC</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(rf_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'Random Forest'</span>)</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - Random Forest'</span>)</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Classification Report (Random Forest) ---
              precision    recall  f1-score   support

           0       0.83      0.89      0.86      1035
           1       0.63      0.49      0.55       374

    accuracy                           0.79      1409
   macro avg       0.73      0.69      0.71      1409
weighted avg       0.78      0.79      0.78      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-36-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (Random Forest): 0.8195</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-36-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="using-class-balancing" class="level3">
<h3 data-anchor-id="using-class-balancing">Using Class Balancing</h3>
<p>To address class imbalance, a hybrid resampling approach combining SMOTE with undersampling is highly effective. SMOTE (Synthetic Minority Over-sampling Technique) avoids overfitting by creating new, synthetic samples for the minority class based on its nearest neighbors, rather than just duplicating data. This is then coupled with an undersampling technique, such as Tomek Links (as in SMOTETomek), which cleans the feature space by removing majority class samples that are close to the newly created synthetic minority points. This dual strategy results in a more balanced and less noisy dataset, allowing the model to learn a clearer and more robust decision boundary between the classes.</p>
</section>
<section id="applying-smote-undersampling-smotetomek" class="level3">
<h3 data-anchor-id="applying-smote-undersampling-smotetomek">Applying SMOTE + Undersampling (SMOTETomek)</h3>
<div id="16a432a1" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>smote_tomek <span class="op">=</span> SMOTETomek(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>X_train_resampled, y_train_resampled <span class="op">=</span> smote_tomek.fit_resample(X_train, y_train)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Class Distribution After Applying SMOTETomek"</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train_resampled.value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Class Distribution After Applying SMOTETomek
Churn
0    3965
1    3965
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="logistic-regression-with-smotetomek" class="level2">
<h2 data-anchor-id="logistic-regression-with-smotetomek">Logistic Regression with SMOTETomek:</h2>
<div id="85292f1b" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>log_reg_smote_model <span class="op">=</span> LogisticRegression(solver<span class="op">=</span><span class="st">'liblinear'</span>, random_state<span class="op">=</span><span class="dv">42</span>, max_iter<span class="op">=</span><span class="dv">1000</span>) <span class="co"># SEM class_weight='balanced'</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>log_reg_smote_model.fit(X_train_resampled, y_train_resampled)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>y_pred_log_reg_smote <span class="op">=</span> log_reg_smote_model.predict(X_test)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>y_proba_log_reg_smote <span class="op">=</span> log_reg_smote_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Logistic Regression with SMOTETomek) ---"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_log_reg_smote))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>cm_log_reg_smote <span class="op">=</span> confusion_matrix(y_test, y_pred_log_reg_smote)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_log_reg_smote, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Real'</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predict'</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix (Logistic Regression with SMOTETomek)'</span>)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>auc_log_reg_smote <span class="op">=</span> roc_auc_score(y_test, y_proba_log_reg_smote)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (Logistic Regression with SMOTETomek): </span><span class="sc">{</span>auc_log_reg_smote<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(log_reg_smote_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'Logistic Regression (SMOTETomek)'</span>)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - Logistic Regression (SMOTETomek)'</span>)</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Classification Report (Logistic Regression with SMOTETomek) ---
              precision    recall  f1-score   support

           0       0.89      0.76      0.82      1035
           1       0.53      0.74      0.62       374

    accuracy                           0.76      1409
   macro avg       0.71      0.75      0.72      1409
weighted avg       0.79      0.76      0.77      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-38-output-2.png" width="502" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (Logistic Regression with SMOTETomek): 0.8323</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-38-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="random-forest-with-smotetomek" class="level2">
<h2 data-anchor-id="random-forest-with-smotetomek">Random Forest with SMOTETomek</h2>
<div id="5ff04a76" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>rf_smote_model <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>, n_estimators<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>rf_smote_model.fit(X_train_resampled, y_train_resampled)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>y_pred_rf_smote <span class="op">=</span> rf_smote_model.predict(X_test)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>y_proba_rf_smote <span class="op">=</span> rf_smote_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Random Forest with SMOTETomek) ---"</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_rf_smote))</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>cm_rf_smote <span class="op">=</span> confusion_matrix(y_test, y_pred_rf_smote)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_rf_smote, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Real'</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predict'</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - Random Forest (SMOTETomek)'</span>)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>auc_rf_smote <span class="op">=</span> roc_auc_score(y_test, y_proba_rf_smote)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (Random Forest w/ SMOTETomek): </span><span class="sc">{</span>auc_rf_smote<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(rf_smote_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'Random Forest (SMOTETomek)'</span>)</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - Random Forest (SMOTETomek)'</span>)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Classification Report (Random Forest with SMOTETomek) ---
              precision    recall  f1-score   support

           0       0.86      0.81      0.84      1035
           1       0.55      0.64      0.59       374

    accuracy                           0.77      1409
   macro avg       0.71      0.73      0.71      1409
weighted avg       0.78      0.77      0.77      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-39-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (Random Forest w/ SMOTETomek): 0.8167</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-39-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="svm-with-smotetomek" class="level2">
<h2 data-anchor-id="svm-with-smotetomek">SVM with SMOTETomek</h2>
<div id="219f0f78" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>svm_model <span class="op">=</span> SVC(kernel<span class="op">=</span><span class="st">'rbf'</span>, probability<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>svm_model.fit(X_train_resampled, y_train_resampled)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>y_pred_svm <span class="op">=</span> svm_model.predict(X_test)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>y_proba_svm <span class="op">=</span> svm_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (SVM with SMOTETomek) ---"</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_svm))</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>cm_svm <span class="op">=</span> confusion_matrix(y_test, y_pred_svm)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_svm, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - SVM (SMOTETomek)'</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>auc_svm <span class="op">=</span> roc_auc_score(y_test, y_proba_svm)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (SVM with SMOTETomek): </span><span class="sc">{</span>auc_svm<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(svm_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'SVM'</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - SVM (SMOTETomek)'</span>)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Classification Report (SVM with SMOTETomek) ---
              precision    recall  f1-score   support

           0       0.89      0.78      0.83      1035
           1       0.55      0.73      0.62       374

    accuracy                           0.77      1409
   macro avg       0.72      0.76      0.73      1409
weighted avg       0.80      0.77      0.78      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-40-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (SVM with SMOTETomek): 0.8233</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-40-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="decision-tree-with-smotetomek" class="level2">
<h2 data-anchor-id="decision-tree-with-smotetomek">Decision Tree with SMOTETomek</h2>
<div id="50329bfa" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>dt_model <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>dt_model.fit(X_train_resampled, y_train_resampled)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>y_pred_dt <span class="op">=</span> dt_model.predict(X_test)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>y_proba_dt <span class="op">=</span> dt_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Decision Tree with SMOTETomek) ---"</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_dt))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>cm_dt <span class="op">=</span> confusion_matrix(y_test, y_pred_dt)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_dt, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - Decision Tree (SMOTETomek)'</span>)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>auc_dt <span class="op">=</span> roc_auc_score(y_test, y_proba_dt)</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (Decision Tree with SMOTETomek): </span><span class="sc">{</span>auc_dt<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(dt_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'Decision Tree'</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - Decision Tree (SMOTETomek)'</span>)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Classification Report (Decision Tree with SMOTETomek) ---
              precision    recall  f1-score   support

           0       0.85      0.77      0.81      1035
           1       0.50      0.61      0.55       374

    accuracy                           0.73      1409
   macro avg       0.67      0.69      0.68      1409
weighted avg       0.75      0.73      0.74      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-41-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (Decision Tree with SMOTETomek): 0.6958</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-41-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="xgboost-with-smotetomek" class="level2">
<h2 data-anchor-id="xgboost-with-smotetomek">XGBoost with SMOTETomek</h2>
<div id="69e285a5" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="op">=</span> XGBClassifier(objective<span class="op">=</span><span class="st">'binary:logistic'</span>, eval_metric<span class="op">=</span><span class="st">'logloss'</span>, use_label_encoder<span class="op">=</span><span class="va">False</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>xgb_model.fit(X_train_resampled, y_train_resampled)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>y_pred_xgb <span class="op">=</span> xgb_model.predict(X_test)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>y_proba_xgb <span class="op">=</span> xgb_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (XGBoost with SMOTETomek) ---"</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_xgb))</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>cm_xgb <span class="op">=</span> confusion_matrix(y_test, y_pred_xgb)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_xgb, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - XGBoost (SMOTETomek)'</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>auc_xgb <span class="op">=</span> roc_auc_score(y_test, y_proba_xgb)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (XGBoost with SMOTETomek): </span><span class="sc">{</span>auc_xgb<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(xgb_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'XGBoost'</span>)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - XGBoost (SMOTETomek)'</span>)</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Classification Report (XGBoost with SMOTETomek) ---
              precision    recall  f1-score   support

           0       0.87      0.80      0.84      1035
           1       0.55      0.68      0.61       374

    accuracy                           0.77      1409
   macro avg       0.71      0.74      0.72      1409
weighted avg       0.79      0.77      0.78      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-42-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (XGBoost with SMOTETomek): 0.8169</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-42-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lightgbm-with-smotetomek" class="level2">
<h2 data-anchor-id="lightgbm-with-smotetomek">LightGBM with SMOTETomek</h2>
<div id="9f2882af" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>lgbm_model <span class="op">=</span> LGBMClassifier(objective<span class="op">=</span><span class="st">'binary'</span>, metric<span class="op">=</span><span class="st">'binary_logloss'</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>lgbm_model.fit(X_train_resampled, y_train_resampled)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>y_pred_lgbm <span class="op">=</span> lgbm_model.predict(X_test)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>y_proba_lgbm <span class="op">=</span> lgbm_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (LightGBM with SMOTETomek) ---"</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_lgbm))</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>cm_lgbm <span class="op">=</span> confusion_matrix(y_test, y_pred_lgbm)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_lgbm, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - LightGBM (SMOTETomek)'</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>auc_lgbm <span class="op">=</span> roc_auc_score(y_test, y_proba_lgbm)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (LightGBM with SMOTETomek): </span><span class="sc">{</span>auc_lgbm<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(lgbm_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'LightGBM'</span>)</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - LightGBM (SMOTETomek)'</span>)</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[LightGBM] [Warning] Found whitespace in feature_names, replace with underlines
[LightGBM] [Info] Number of positive: 3965, number of negative: 3965
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.000928 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 550
[LightGBM] [Info] Number of data points in the train set: 7930, number of used features: 22
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.500000 -&gt; initscore=0.000000

--- Classification Report (LightGBM with SMOTETomek) ---
              precision    recall  f1-score   support

           0       0.88      0.78      0.83      1035
           1       0.54      0.69      0.61       374

    accuracy                           0.76      1409
   macro avg       0.71      0.74      0.72      1409
weighted avg       0.79      0.76      0.77      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-43-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (LightGBM with SMOTETomek): 0.8268</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-43-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="k-nearest-neighbors-knn-with-smotetomek" class="level2">
<h2 data-anchor-id="k-nearest-neighbors-knn-with-smotetomek">K-Nearest Neighbors (KNN) with SMOTETomek</h2>
<div id="98dd9ba6" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>knn_model <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>knn_model.fit(X_train_resampled, y_train_resampled)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>y_pred_knn <span class="op">=</span> knn_model.predict(X_test)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>y_proba_knn <span class="op">=</span> knn_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (KNN with SMOTETomek) ---"</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_knn))</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>cm_knn <span class="op">=</span> confusion_matrix(y_test, y_pred_knn)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_knn, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - KNN (SMOTETomek)'</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>auc_knn <span class="op">=</span> roc_auc_score(y_test, y_proba_knn)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">AUC-ROC (KNN with SMOTETomek): </span><span class="sc">{</span>auc_knn<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(knn_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'KNN'</span>)</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - KNN (SMOTETomek)'</span>)</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Classification Report (KNN with SMOTETomek) ---
              precision    recall  f1-score   support

           0       0.88      0.71      0.79      1035
           1       0.48      0.74      0.58       374

    accuracy                           0.72      1409
   macro avg       0.68      0.72      0.68      1409
weighted avg       0.77      0.72      0.73      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-44-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
AUC-ROC (KNN with SMOTETomek): 0.7799</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-44-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="results-summary" class="level3">
<h3 data-anchor-id="results-summary">Results Summary</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 22%">
<col style="width: 16%">
<col style="width: 14%">
<col style="width: 16%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: left;">Approach</th>
<th style="text-align: left;">Precision (Churn=1)</th>
<th style="text-align: left;">Recall (Churn=1)</th>
<th style="text-align: left;">F1-Score (Churn=1)</th>
<th style="text-align: left;">AUC-ROC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Logistic Regression</td>
<td style="text-align: left;"><code>class_weight='balanced'</code></td>
<td style="text-align: left;">0.51</td>
<td style="text-align: left;"><strong>0.78</strong></td>
<td style="text-align: left;">0.62</td>
<td style="text-align: left;"><strong>0.8389</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Random Forest</td>
<td style="text-align: left;"><code>class_weight='balanced'</code></td>
<td style="text-align: left;"><strong>0.63</strong></td>
<td style="text-align: left;">0.49</td>
<td style="text-align: left;">0.55</td>
<td style="text-align: left;">0.8195</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Logistic Regression</td>
<td style="text-align: left;">SMOTETomek</td>
<td style="text-align: left;">0.53</td>
<td style="text-align: left;">0.74</td>
<td style="text-align: left;">0.62</td>
<td style="text-align: left;">0.8323</td>
</tr>
<tr class="even">
<td style="text-align: left;">Random Forest</td>
<td style="text-align: left;">SMOTETomek</td>
<td style="text-align: left;">0.55</td>
<td style="text-align: left;">0.64</td>
<td style="text-align: left;">0.59</td>
<td style="text-align: left;">0.8167</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SVM</td>
<td style="text-align: left;">SMOTETomek</td>
<td style="text-align: left;">0.55</td>
<td style="text-align: left;">0.73</td>
<td style="text-align: left;">0.62</td>
<td style="text-align: left;">0.8233</td>
</tr>
<tr class="even">
<td style="text-align: left;">Decision Tree</td>
<td style="text-align: left;">SMOTETomek</td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">0.61</td>
<td style="text-align: left;">0.55</td>
<td style="text-align: left;">0.6958</td>
</tr>
<tr class="odd">
<td style="text-align: left;">XGBoost</td>
<td style="text-align: left;">SMOTETomek</td>
<td style="text-align: left;">0.55</td>
<td style="text-align: left;">0.68</td>
<td style="text-align: left;">0.61</td>
<td style="text-align: left;">0.8169</td>
</tr>
<tr class="even">
<td style="text-align: left;">LightGBM</td>
<td style="text-align: left;">SMOTETomek</td>
<td style="text-align: left;">0.54</td>
<td style="text-align: left;">0.69</td>
<td style="text-align: left;">0.61</td>
<td style="text-align: left;">0.8268</td>
</tr>
<tr class="odd">
<td style="text-align: left;">K-Nearest Neighbors (KNN)</td>
<td style="text-align: left;">SMOTETomek</td>
<td style="text-align: left;">0.48</td>
<td style="text-align: left;"><strong>0.74</strong></td>
<td style="text-align: left;">0.58</td>
<td style="text-align: left;">0.7799</td>
</tr>
</tbody>
</table>
</section>
<section id="cross-validation-and-hyperparameter-optimization" class="level3">
<h3 data-anchor-id="cross-validation-and-hyperparameter-optimization">Cross-Validation and Hyperparameter Optimization</h3>
<div id="f16b147d" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>count_class_0 <span class="op">=</span> y_train.value_counts()[<span class="dv">0</span>]</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>count_class_1 <span class="op">=</span> y_train.value_counts()[<span class="dv">1</span>]</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>scale_pos_weight_value <span class="op">=</span> count_class_0 <span class="op">/</span> count_class_1</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of No Churn (class 0) in training set: </span><span class="sc">{</span>count_class_0<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of Churn (class 1) in training set: </span><span class="sc">{</span>count_class_1<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Calculated scale_pos_weight: </span><span class="sc">{</span>scale_pos_weight_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>recall_scorer <span class="op">=</span> make_scorer(recall_score, pos_label<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Number of No Churn (class 0) in training set: 4139
Number of Churn (class 1) in training set: 1495
Calculated scale_pos_weight: 2.7686</code></pre>
</div>
</div>
</section>
</section>
<section id="logistic-regression---tunned" class="level2">
<h2 data-anchor-id="logistic-regression---tunned">Logistic Regression - Tunned</h2>
<div id="1a79783d" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Optimizing Hyperparameters for Logistic Regression (class_weight='balanced') ---"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>log_reg_base <span class="op">=</span> LogisticRegression(class_weight<span class="op">=</span><span class="st">'balanced'</span>, solver<span class="op">=</span><span class="st">'liblinear'</span>, random_state<span class="op">=</span><span class="dv">42</span>, max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>param_grid_lr <span class="op">=</span> {</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>: np.logspace(<span class="op">-</span><span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">6</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>grid_search_lr <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>log_reg_base,</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>                               param_grid<span class="op">=</span>param_grid_lr,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>                               scoring<span class="op">=</span>recall_scorer,</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>                               cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>                               n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>                               verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>grid_search_lr.fit(X_train, y_train)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Parameters (Logistic Regression): </span><span class="sc">{</span>grid_search_lr<span class="sc">.</span>best_params_<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Recall (Logistic Regression) on CV: </span><span class="sc">{</span>grid_search_lr<span class="sc">.</span>best_score_<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>best_lr_model <span class="op">=</span> grid_search_lr.best_estimator_</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>y_pred_lr_tuned <span class="op">=</span> best_lr_model.predict(X_test)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>y_proba_lr_tuned <span class="op">=</span> best_lr_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Tuned Logistic Regression) ---"</span>)</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_lr_tuned))</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>cm_lr_tuned <span class="op">=</span> confusion_matrix(y_test, y_pred_lr_tuned)</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_lr_tuned, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - Tuned Logistic Regression'</span>)</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>auc_lr_tuned <span class="op">=</span> roc_auc_score(y_test, y_proba_lr_tuned)</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC-ROC (Tuned Logistic Regression): </span><span class="sc">{</span>auc_lr_tuned<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(best_lr_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'Tuned Logistic Regression'</span>)</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - Tuned Logistic Regression'</span>)</span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Optimizing Hyperparameters for Logistic Regression (class_weight='balanced') ---
Fitting 5 folds for each of 6 candidates, totalling 30 fits
Best Parameters (Logistic Regression): {'C': 0.001}
Best Recall (Logistic Regression) on CV: 0.7946

--- Classification Report (Tuned Logistic Regression) ---
              precision    recall  f1-score   support

           0       0.91      0.70      0.79      1035
           1       0.49      0.80      0.61       374

    accuracy                           0.73      1409
   macro avg       0.70      0.75      0.70      1409
weighted avg       0.80      0.73      0.74      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-46-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC-ROC (Tuned Logistic Regression): 0.8353</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-46-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="random-forest---tunned" class="level2">
<h2 data-anchor-id="random-forest---tunned">Random Forest - Tunned</h2>
<div id="0e8da66d" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- Optimizing Hyperparameters for Random Forest (class_weight='balanced') ---"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>rf_base <span class="op">=</span> RandomForestClassifier(class_weight<span class="op">=</span><span class="st">'balanced'</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>param_grid_rf <span class="op">=</span> {</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>], <span class="co"># Number of trees</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="va">None</span>, <span class="dv">10</span>, <span class="dv">20</span>], <span class="co"># Maximum tree depth</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_split'</span>: [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>] <span class="co"># Minimum number of samples to split a node</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>grid_search_rf <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>rf_base,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>                               param_grid<span class="op">=</span>param_grid_rf,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>                               scoring<span class="op">=</span>recall_scorer,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>                               cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>                               n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>                               verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>grid_search_rf.fit(X_train, y_train)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Parameters (Random Forest): </span><span class="sc">{</span>grid_search_rf<span class="sc">.</span>best_params_<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Recall (Random Forest) on CV: </span><span class="sc">{</span>grid_search_rf<span class="sc">.</span>best_score_<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>best_rf_model <span class="op">=</span> grid_search_rf.best_estimator_</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>y_pred_rf_tuned <span class="op">=</span> best_rf_model.predict(X_test)</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>y_proba_rf_tuned <span class="op">=</span> best_rf_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (Random Forest Tuned) ---"</span>)</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_rf_tuned))</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>cm_rf_tuned <span class="op">=</span> confusion_matrix(y_test, y_pred_rf_tuned)</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_rf_tuned, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - Random Forest Tuned'</span>)</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>auc_rf_tuned <span class="op">=</span> roc_auc_score(y_test, y_proba_rf_tuned)</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC-ROC (Random Forest Tuned): </span><span class="sc">{</span>auc_rf_tuned<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(best_rf_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'Random Forest Tuned'</span>)</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - Random Forest Tuned'</span>)</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Optimizing Hyperparameters for Random Forest (class_weight='balanced') ---
Fitting 5 folds for each of 27 candidates, totalling 135 fits
Best Parameters (Random Forest): {'max_depth': 10, 'min_samples_split': 10, 'n_estimators': 200}
Best Recall (Random Forest) on CV: 0.7378

--- Classification Report (Random Forest Tuned) ---
              precision    recall  f1-score   support

           0       0.89      0.77      0.83      1035
           1       0.54      0.74      0.62       374

    accuracy                           0.76      1409
   macro avg       0.72      0.76      0.73      1409
weighted avg       0.80      0.76      0.77      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-47-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC-ROC (Random Forest Tuned): 0.8421</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-47-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="support-vector-machine-svm---tunned" class="level2">
<h2 data-anchor-id="support-vector-machine-svm---tunned">Support Vector Machine (SVM) - Tunned</h2>
<div id="1eb60103" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- Optimizing Hyperparameters for SVM (class_weight='balanced') ---"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>svm_base <span class="op">=</span> SVC(class_weight<span class="op">=</span><span class="st">'balanced'</span>, probability<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>param_grid_svm <span class="op">=</span> {</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>: [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>],</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gamma'</span>: [<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>],</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'kernel'</span>: [<span class="st">'rbf'</span>]</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>grid_search_svm <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>svm_base,</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>                               param_grid<span class="op">=</span>param_grid_svm,</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>                               scoring<span class="op">=</span>recall_scorer,</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>                               cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>                               n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>                               verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>grid_search_svm.fit(X_train, y_train)</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Parameters (SVM): </span><span class="sc">{</span>grid_search_svm<span class="sc">.</span>best_params_<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Recall (SVM) on CV: </span><span class="sc">{</span>grid_search_svm<span class="sc">.</span>best_score_<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>best_svm_model <span class="op">=</span> grid_search_svm.best_estimator_</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>y_pred_svm_tuned <span class="op">=</span> best_svm_model.predict(X_test)</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>y_proba_svm_tuned <span class="op">=</span> best_svm_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (SVM Tuned) ---"</span>)</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_svm_tuned))</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>cm_svm_tuned <span class="op">=</span> confusion_matrix(y_test, y_pred_svm_tuned)</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_svm_tuned, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - SVM Tuned'</span>)</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>auc_svm_tuned <span class="op">=</span> roc_auc_score(y_test, y_proba_svm_tuned)</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC-ROC (SVM Tuned): </span><span class="sc">{</span>auc_svm_tuned<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(best_svm_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'SVM Tuned'</span>)</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - SVM Tuned'</span>)</span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Optimizing Hyperparameters for SVM (class_weight='balanced') ---
Fitting 5 folds for each of 12 candidates, totalling 60 fits
Best Parameters (SVM): {'C': 0.1, 'gamma': 0.001, 'kernel': 'rbf'}
Best Recall (SVM) on CV: 0.8776

--- Classification Report (SVM Tuned) ---
              precision    recall  f1-score   support

           0       0.93      0.62      0.74      1035
           1       0.46      0.88      0.60       374

    accuracy                           0.69      1409
   macro avg       0.69      0.75      0.67      1409
weighted avg       0.81      0.69      0.71      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-48-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC-ROC (SVM Tuned): 0.8334</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-48-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="xgboost--tunned" class="level2">
<h2 data-anchor-id="xgboost--tunned">XGBoost- Tunned</h2>
<div id="8a21e377" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- Optimizing Hyperparameters for XGBoost (scale_pos_weight) ---"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>xgb_base <span class="op">=</span> XGBClassifier(objective<span class="op">=</span><span class="st">'binary:logistic'</span>, eval_metric<span class="op">=</span><span class="st">'logloss'</span>,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                         use_label_encoder<span class="op">=</span><span class="va">False</span>, random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                         scale_pos_weight<span class="op">=</span>scale_pos_weight_value)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>param_grid_xgb <span class="op">=</span> {</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: [<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>],</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>],</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'colsample_bytree'</span>: [<span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>]</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>grid_search_xgb <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>xgb_base,</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>                               param_grid<span class="op">=</span>param_grid_xgb,</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>                               scoring<span class="op">=</span>recall_scorer,</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>                               cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>                               n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>                               verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>grid_search_xgb.fit(X_train, y_train)</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Parameters (XGBoost): </span><span class="sc">{</span>grid_search_xgb<span class="sc">.</span>best_params_<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Recall (XGBoost) on CV: </span><span class="sc">{</span>grid_search_xgb<span class="sc">.</span>best_score_<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>best_xgb_model <span class="op">=</span> grid_search_xgb.best_estimator_</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>y_pred_xgb_tuned <span class="op">=</span> best_xgb_model.predict(X_test)</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>y_proba_xgb_tuned <span class="op">=</span> best_xgb_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (XGBoost Tuned) ---"</span>)</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_xgb_tuned))</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>cm_xgb_tuned <span class="op">=</span> confusion_matrix(y_test, y_pred_xgb_tuned)</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_xgb_tuned, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - XGBoost Tuned'</span>)</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>auc_xgb_tuned <span class="op">=</span> roc_auc_score(y_test, y_proba_xgb_tuned)</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC-ROC (XGBoost Tuned): </span><span class="sc">{</span>auc_xgb_tuned<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(best_xgb_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'XGBoost Tuned'</span>)</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - XGBoost Tuned'</span>)</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Optimizing Hyperparameters for XGBoost (scale_pos_weight) ---
Fitting 5 folds for each of 81 candidates, totalling 405 fits
Best Parameters (XGBoost): {'colsample_bytree': 0.8, 'learning_rate': 0.01, 'max_depth': 3, 'n_estimators': 200}
Best Recall (XGBoost) on CV: 0.8294

--- Classification Report (XGBoost Tuned) ---
              precision    recall  f1-score   support

           0       0.91      0.70      0.79      1035
           1       0.49      0.81      0.61       374

    accuracy                           0.73      1409
   macro avg       0.70      0.75      0.70      1409
weighted avg       0.80      0.73      0.74      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-49-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC-ROC (XGBoost Tuned): 0.8410</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-49-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lightgbm---tunned" class="level2">
<h2 data-anchor-id="lightgbm---tunned">LightGBM - Tunned</h2>
<div id="13a150cc" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- Optimizing Hyperparameters for LightGBM (scale_pos_weight) ---"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>lgbm_base <span class="op">=</span> LGBMClassifier(objective<span class="op">=</span><span class="st">'binary'</span>, metric<span class="op">=</span><span class="st">'binary_logloss'</span>,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                           random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>                           scale_pos_weight<span class="op">=</span>scale_pos_weight_value)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>param_grid_lgbm <span class="op">=</span> {</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: [<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>],</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'num_leaves'</span>: [<span class="dv">20</span>, <span class="dv">31</span>, <span class="dv">40</span>],</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'reg_alpha'</span>: [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>],</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'reg_lambda'</span>: [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>]</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>grid_search_lgbm <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>lgbm_base,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>                               param_grid<span class="op">=</span>param_grid_lgbm,</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>                               scoring<span class="op">=</span>recall_scorer,</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>                               cv<span class="op">=</span>StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>                               n_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>                               verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>grid_search_lgbm.fit(X_train, y_train)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Parameters (LightGBM): </span><span class="sc">{</span>grid_search_lgbm<span class="sc">.</span>best_params_<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Recall (LightGBM) on CV: </span><span class="sc">{</span>grid_search_lgbm<span class="sc">.</span>best_score_<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>best_lgbm_model <span class="op">=</span> grid_search_lgbm.best_estimator_</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>y_pred_lgbm_tuned <span class="op">=</span> best_lgbm_model.predict(X_test)</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>y_proba_lgbm_tuned <span class="op">=</span> best_lgbm_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Classification Report (LightGBM Tuned) ---"</span>)</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_lgbm_tuned))</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>cm_lgbm_tuned <span class="op">=</span> confusion_matrix(y_test, y_pred_lgbm_tuned)</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cm_lgbm_tuned, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>            xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>            yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix - LightGBM Tuned'</span>)</span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>auc_lgbm_tuned <span class="op">=</span> roc_auc_score(y_test, y_proba_lgbm_tuned)</span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC-ROC (LightGBM Tuned): </span><span class="sc">{</span>auc_lgbm_tuned<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>RocCurveDisplay.from_estimator(best_lgbm_model, X_test, y_test, ax<span class="op">=</span>ax, name<span class="op">=</span><span class="st">'LightGBM Tuned'</span>)</span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ROC Curve - LightGBM Tuned'</span>)</span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Random'</span>)</span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Optimizing Hyperparameters for LightGBM (scale_pos_weight) ---
Fitting 5 folds for each of 243 candidates, totalling 1215 fits
[LightGBM] [Warning] Found whitespace in feature_names, replace with underlines
[LightGBM] [Info] Number of positive: 1495, number of negative: 4139
[LightGBM] [Info] Auto-choosing row-wise multi-threading, the overhead of testing was 0.003790 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 369
[LightGBM] [Info] Number of data points in the train set: 5634, number of used features: 22
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.265353 -&gt; initscore=-1.018328
[LightGBM] [Info] Start training from score -1.018328
Best Parameters (LightGBM): {'learning_rate': 0.05, 'n_estimators': 100, 'num_leaves': 20, 'reg_alpha': 0.5, 'reg_lambda': 0.5}
Best Recall (LightGBM) on CV: 0.7873

--- Classification Report (LightGBM Tuned) ---
              precision    recall  f1-score   support

           0       0.91      0.74      0.82      1035
           1       0.52      0.79      0.63       374

    accuracy                           0.75      1409
   macro avg       0.72      0.77      0.72      1409
weighted avg       0.81      0.75      0.77      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-50-output-2.png" width="493" height="449" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC-ROC (LightGBM Tuned): 0.8428</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-50-output-4.png" width="515" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The optimized versions with scale_pos_weight consistently outperform their SMOTETomek-based counterparts in AUC, Recall, and F1-Score. The conclusion is that, for this problem and dataset, using class_weight and scale_pos_weight in conjunction with hyperparameter optimization was the most effective strategy for achieving high Recall and AUC, surpassing the resampling approach with SMOTETomek.</p>
</section>
</section>
<section id="comparison-of-model-performance-metrics" class="level1">
<h1>Comparison of Model Performance Metrics</h1>
<section id="results-consolidation" class="level6">
<h6 data-anchor-id="results-consolidation">Results Consolidation:</h6>
<div id="bb6eb2f0" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Original Models (Without Optimization)</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>data_initial <span class="op">=</span> [</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Logistic Regression'</span>, <span class="st">"class_weight='balanced'"</span>, <span class="fl">0.51</span>, <span class="fl">0.78</span>, <span class="fl">0.62</span>, <span class="fl">0.8389</span>, <span class="st">"Inicial"</span>],</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Random Forest'</span>, <span class="st">"class_weight='balanced'"</span>, <span class="fl">0.63</span>, <span class="fl">0.49</span>, <span class="fl">0.55</span>, <span class="fl">0.8195</span>, <span class="st">"Inicial"</span>],</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Logistic Regression'</span>, <span class="st">"SMOTETomek"</span>, <span class="fl">0.53</span>, <span class="fl">0.74</span>, <span class="fl">0.62</span>, <span class="fl">0.8323</span>, <span class="st">"Inicial"</span>],</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Random Forest'</span>, <span class="st">"SMOTETomek"</span>, <span class="fl">0.55</span>, <span class="fl">0.64</span>, <span class="fl">0.59</span>, <span class="fl">0.8167</span>, <span class="st">"Inicial"</span>],</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'SVM'</span>, <span class="st">"SMOTETomek"</span>, <span class="fl">0.55</span>, <span class="fl">0.73</span>, <span class="fl">0.62</span>, <span class="fl">0.8233</span>, <span class="st">"Inicial"</span>],</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Decision Tree'</span>, <span class="st">"SMOTETomek"</span>, <span class="fl">0.50</span>, <span class="fl">0.61</span>, <span class="fl">0.55</span>, <span class="fl">0.6958</span>, <span class="st">"Inicial"</span>],</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'XGBoost'</span>, <span class="st">"SMOTETomek"</span>, <span class="fl">0.55</span>, <span class="fl">0.68</span>, <span class="fl">0.61</span>, <span class="fl">0.8169</span>, <span class="st">"Inicial"</span>],</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'LightGBM'</span>, <span class="st">"SMOTETomek"</span>, <span class="fl">0.54</span>, <span class="fl">0.69</span>, <span class="fl">0.61</span>, <span class="fl">0.8268</span>, <span class="st">"Inicial"</span>],</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'KNN'</span>, <span class="st">"SMOTETomek"</span>, <span class="fl">0.48</span>, <span class="fl">0.74</span>, <span class="fl">0.58</span>, <span class="fl">0.7799</span>, <span class="st">"Inicial"</span>]</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Tuned Models (Optimized)</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>data_tuned <span class="op">=</span> [</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Logistic Regression'</span>, <span class="st">"class_weight='balanced'"</span>, <span class="fl">0.49</span>, <span class="fl">0.80</span>, <span class="fl">0.61</span>, <span class="fl">0.8353</span>, <span class="st">"Tuned"</span>],</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Random Forest'</span>, <span class="st">"class_weight='balanced'"</span>, <span class="fl">0.54</span>, <span class="fl">0.74</span>, <span class="fl">0.62</span>, <span class="fl">0.8421</span>, <span class="st">"Tuned"</span>],</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'SVM'</span>, <span class="st">"class_weight='balanced'"</span>, <span class="fl">0.46</span>, <span class="fl">0.88</span>, <span class="fl">0.60</span>, <span class="fl">0.8334</span>, <span class="st">"Tuned"</span>],</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'XGBoost'</span>, <span class="st">"scale_pos_weight"</span>, <span class="fl">0.49</span>, <span class="fl">0.81</span>, <span class="fl">0.61</span>, <span class="fl">0.8410</span>, <span class="st">"Tuned"</span>],</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'LightGBM'</span>, <span class="st">"scale_pos_weight"</span>, <span class="fl">0.52</span>, <span class="fl">0.79</span>, <span class="fl">0.63</span>, <span class="fl">0.8428</span>, <span class="st">"Tuned"</span>]</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Consolidate</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">'Model'</span>, <span class="st">'Aproach'</span>, <span class="st">'Precision (Churn=1)'</span>, <span class="st">'Recall (Churn=1)'</span>, </span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>           <span class="st">'F1-Score (Churn=1)'</span>, <span class="st">'AUC-ROC'</span>, <span class="st">'Status'</span>]</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>df_results <span class="op">=</span> pd.DataFrame(data_initial <span class="op">+</span> data_tuned, columns<span class="op">=</span>columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="sorting-by-recall-churn1" class="level6">
<h6 data-anchor-id="sorting-by-recall-churn1">Sorting by Recall (Churn=1):</h6>
<div id="0fb1dda0" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df_sorted <span class="op">=</span> df_results.sort_values(by<span class="op">=</span><span class="st">"Recall (Churn=1)"</span>, ascending<span class="op">=</span><span class="va">False</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>display(df_sorted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">Aproach</th>
<th data-quarto-table-cell-role="th">Precision (Churn=1)</th>
<th data-quarto-table-cell-role="th">Recall (Churn=1)</th>
<th data-quarto-table-cell-role="th">F1-Score (Churn=1)</th>
<th data-quarto-table-cell-role="th">AUC-ROC</th>
<th data-quarto-table-cell-role="th">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SVM</td>
<td>class_weight='balanced'</td>
<td>0.46</td>
<td>0.88</td>
<td>0.60</td>
<td>0.8334</td>
<td>Tuned</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>XGBoost</td>
<td>scale_pos_weight</td>
<td>0.49</td>
<td>0.81</td>
<td>0.61</td>
<td>0.8410</td>
<td>Tuned</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Logistic Regression</td>
<td>class_weight='balanced'</td>
<td>0.49</td>
<td>0.80</td>
<td>0.61</td>
<td>0.8353</td>
<td>Tuned</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>LightGBM</td>
<td>scale_pos_weight</td>
<td>0.52</td>
<td>0.79</td>
<td>0.63</td>
<td>0.8428</td>
<td>Tuned</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Logistic Regression</td>
<td>class_weight='balanced'</td>
<td>0.51</td>
<td>0.78</td>
<td>0.62</td>
<td>0.8389</td>
<td>Inicial</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Logistic Regression</td>
<td>SMOTETomek</td>
<td>0.53</td>
<td>0.74</td>
<td>0.62</td>
<td>0.8323</td>
<td>Inicial</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>KNN</td>
<td>SMOTETomek</td>
<td>0.48</td>
<td>0.74</td>
<td>0.58</td>
<td>0.7799</td>
<td>Inicial</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Random Forest</td>
<td>class_weight='balanced'</td>
<td>0.54</td>
<td>0.74</td>
<td>0.62</td>
<td>0.8421</td>
<td>Tuned</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>SVM</td>
<td>SMOTETomek</td>
<td>0.55</td>
<td>0.73</td>
<td>0.62</td>
<td>0.8233</td>
<td>Inicial</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>LightGBM</td>
<td>SMOTETomek</td>
<td>0.54</td>
<td>0.69</td>
<td>0.61</td>
<td>0.8268</td>
<td>Inicial</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>XGBoost</td>
<td>SMOTETomek</td>
<td>0.55</td>
<td>0.68</td>
<td>0.61</td>
<td>0.8169</td>
<td>Inicial</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Random Forest</td>
<td>SMOTETomek</td>
<td>0.55</td>
<td>0.64</td>
<td>0.59</td>
<td>0.8167</td>
<td>Inicial</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Decision Tree</td>
<td>SMOTETomek</td>
<td>0.50</td>
<td>0.61</td>
<td>0.55</td>
<td>0.6958</td>
<td>Inicial</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Random Forest</td>
<td>class_weight='balanced'</td>
<td>0.63</td>
<td>0.49</td>
<td>0.55</td>
<td>0.8195</td>
<td>Inicial</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="visuals-one-plot-for-each-metric" class="level6">
<h6 data-anchor-id="visuals-one-plot-for-each-metric">Visuals: One plot for each metric :</h6>
<div id="ccaa1dde" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>modelos_com_tuned <span class="op">=</span> [<span class="st">'Logistic Regression'</span>, <span class="st">'Random Forest'</span>, <span class="st">'SVM'</span>, <span class="st">'XGBoost'</span>, <span class="st">'LightGBM'</span>]</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df_results[df_results[<span class="st">'Model'</span>].isin(modelos_com_tuned)]</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">5</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>metricas <span class="op">=</span> {</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Precision (Churn=1)'</span>: <span class="st">'Precision'</span>,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Recall (Churn=1)'</span>: <span class="st">'Recall'</span>,</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'F1-Score (Churn=1)'</span>: <span class="st">'F1-Score'</span>,</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AUC-ROC'</span>: <span class="st">'AUC-ROC'</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> metrica, titulo <span class="kw">in</span> metricas.items():</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    ordem <span class="op">=</span> (</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>        df_filtered[df_filtered[<span class="st">"Status"</span>]<span class="op">==</span><span class="st">"Tuned"</span>]</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>        .sort_values(by<span class="op">=</span>metrica, ascending<span class="op">=</span><span class="va">True</span>)[<span class="st">"Model"</span>]</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>        .tolist()</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    sns.barplot(</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"Model"</span>, y<span class="op">=</span>metrica, hue<span class="op">=</span><span class="st">"Status"</span>, </span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df_filtered, palette<span class="op">=</span><span class="st">"Set2"</span>, order<span class="op">=</span>ordem</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>titulo<span class="sc">}</span><span class="ss"> by Model (Initial vs Tuned)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(titulo)</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Model"</span>)</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-53-output-1.png" width="758" height="471" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-53-output-2.png" width="758" height="471" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-53-output-3.png" width="758" height="471" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-53-output-4.png" width="758" height="471" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="radar-chart" class="level6">
<h6 data-anchor-id="radar-chart">Radar Chart:</h6>
<div id="45b8990c" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df_tuned_only <span class="op">=</span> df_results[df_results[<span class="st">'Status'</span>] <span class="op">==</span> <span class="st">"Tuned"</span>].set_index(<span class="st">"Model"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [<span class="st">'Precision (Churn=1)'</span>, <span class="st">'Recall (Churn=1)'</span>, <span class="st">'F1-Score (Churn=1)'</span>, <span class="st">'AUC-ROC'</span>]</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>df_metrics <span class="op">=</span> df_tuned_only[metrics]</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>df_norm <span class="op">=</span> df_metrics.<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x <span class="op">-</span> x.<span class="bu">min</span>()) <span class="op">/</span> (x.<span class="bu">max</span>() <span class="op">-</span> x.<span class="bu">min</span>()))</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> metrics</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>num_vars <span class="op">=</span> <span class="bu">len</span>(labels)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>angles <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">2</span> <span class="op">*</span> np.pi, num_vars, endpoint<span class="op">=</span><span class="va">False</span>).tolist()</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>angles <span class="op">+=</span> angles[:<span class="dv">1</span>]</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.subplot(<span class="dv">111</span>, polar<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> df_norm.iterrows():</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> row.tolist()</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    values <span class="op">+=</span> values[:<span class="dv">1</span>]  <span class="co"># close the plot</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(angles, values, label<span class="op">=</span>idx, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    ax.fill(angles, values, alpha<span class="op">=</span><span class="fl">0.15</span>)</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(angles[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(labels, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>ax.set_yticks([<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span>])</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels([<span class="st">"0.2"</span>,<span class="st">"0.4"</span>,<span class="st">"0.6"</span>,<span class="st">"0.8"</span>,<span class="st">"1.0"</span>], fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Radar Chart - Comparison of Tuned Models"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"upper right"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.2</span>, <span class="fl">1.1</span>))</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-54-output-1.png" width="643" height="557" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Considering the results, the most promising models are:</p>
<ul>
<li>Optimized LightGBM: Highest AUC and F1-Score, and an excellent Recall (0.79). It offers the best overall balance.</li>
<li>Optimized SVM: Highest Recall (0.88), but with the lowest Precision (0.46). It is important to evaluate if the cost of False Positives is justified by the extremely high Recall.</li>
</ul>
</section>
<section id="treshold-tunning" class="level3">
<h3 data-anchor-id="treshold-tunning">Treshold Tunning</h3>
<p>Now that we have optimized models with excellent metrics, the next step is threshold tuning.</p>
<p>All the models we have used have a default classification threshold of 0.5. This means that if the predicted probability of churn is &gt;= 0.5, the customer is classified as “churn”; otherwise, they are classified as “no churn”. However, for our problem, where Recall is the priority and Precision is a secondary concern, the 0.5 threshold may not be optimal.</p>
<p>We need to find a cutoff point that maximizes Recall for the “Churn” class (to avoid missing customers who are going to cancel), while maintaining Precision at an acceptable level (to avoid spending excessive resources on False Positives).</p>
</section>
<section id="lightgbm-and-svm-tunned" class="level2">
<h2 data-anchor-id="lightgbm-and-svm-tunned">LightGBM and SVM Tunned</h2>
<div id="1ed47400" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_pr_curve_and_evaluate_threshold(model, X_test, y_test, model_name):</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    y_proba <span class="op">=</span> model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    precision, recall, thresholds <span class="op">=</span> precision_recall_curve(y_test, y_proba)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    auprc <span class="op">=</span> auc(recall, precision)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- Cutoff Point Analysis for: </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss"> ---"</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Area Under the Precision-Recall Curve (AUPRC): </span><span class="sc">{</span>auprc<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(recall, precision, marker<span class="op">=</span><span class="st">'.'</span>, label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss"> (AUPRC = </span><span class="sc">{</span>auprc<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Recall (Coverage)'</span>)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Precision'</span>)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Precision-Recall Curve - </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Precision and Recall at different Cutoff Points:"</span>)</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    selected_threshold_indices <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="bu">len</span>(thresholds) <span class="op">-</span> <span class="dv">1</span>, <span class="dv">10</span>).astype(<span class="bu">int</span>)</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Threshold | Precision  | Recall"</span>)</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"----------------------------"</span>)</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> selected_threshold_indices:</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>        idx <span class="op">=</span> <span class="bu">min</span>(i, <span class="bu">len</span>(thresholds) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>thresholds[idx]<span class="sc">:&lt;9.2f}</span><span class="ss"> | </span><span class="sc">{</span>precision[idx]<span class="sc">:&lt;8.2f}</span><span class="ss">   | </span><span class="sc">{</span>recall[idx]<span class="sc">:&lt;6.2f}</span><span class="ss">"</span>)</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Evaluation Example with a Custom Threshold (Default 0.5):"</span>)</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>    custom_threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>    y_pred_custom_threshold <span class="op">=</span> (y_proba <span class="op">&gt;=</span> custom_threshold).astype(<span class="bu">int</span>)</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Classification Report for Threshold = </span><span class="sc">{</span>custom_threshold<span class="sc">:.2f}</span><span class="ss">:"</span>)</span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(classification_report(y_test, y_pred_custom_threshold))</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>    cm_custom <span class="op">=</span> confusion_matrix(y_test, y_pred_custom_threshold)</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>    sns.heatmap(cm_custom, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>,</span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>                xticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>],</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>                yticklabels<span class="op">=</span>[<span class="st">'No Churn (0)'</span>, <span class="st">'Churn (1)'</span>])</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Actual'</span>)</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Predicted'</span>)</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Confusion Matrix - </span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ss"> (Threshold: </span><span class="sc">{</span>custom_threshold<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimized LightGBM</span></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>plot_pr_curve_and_evaluate_threshold(best_lgbm_model, X_test, y_test, <span class="st">"Optimized LightGBM"</span>)</span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimized SVM</span></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a>plot_pr_curve_and_evaluate_threshold(best_svm_model, X_test, y_test, <span class="st">"Optimized SVM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Cutoff Point Analysis for: Optimized LightGBM ---
Area Under the Precision-Recall Curve (AUPRC): 0.6565</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-55-output-2.png" width="660" height="521" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Precision and Recall at different Cutoff Points:
Threshold | Precision  | Recall
----------------------------
0.01      | 0.27       | 1.00  
0.04      | 0.30       | 1.00  
0.07      | 0.34       | 0.99  
0.16      | 0.38       | 0.96  
0.28      | 0.43       | 0.92  
0.42      | 0.49       | 0.83  
0.59      | 0.55       | 0.71  
0.71      | 0.65       | 0.56  
0.81      | 0.72       | 0.32  
0.95      | 1.00       | 0.00  

Evaluation Example with a Custom Threshold (Default 0.5):
Classification Report for Threshold = 0.50:
              precision    recall  f1-score   support

           0       0.91      0.74      0.82      1035
           1       0.52      0.79      0.63       374

    accuracy                           0.75      1409
   macro avg       0.72      0.77      0.72      1409
weighted avg       0.81      0.75      0.77      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-55-output-4.png" width="487" height="447" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Cutoff Point Analysis for: Optimized SVM ---
Area Under the Precision-Recall Curve (AUPRC): 0.6254</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-55-output-6.png" width="660" height="521" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Precision and Recall at different Cutoff Points:
Threshold | Precision  | Recall
----------------------------
0.00      | 0.27       | 1.00  
0.02      | 0.30       | 0.99  
0.04      | 0.34       | 0.99  
0.08      | 0.38       | 0.96  
0.14      | 0.43       | 0.90  
0.22      | 0.49       | 0.82  
0.32      | 0.54       | 0.69  
0.49      | 0.62       | 0.53  
0.68      | 0.70       | 0.29  
0.88      | 1.00       | 0.00  

Evaluation Example with a Custom Threshold (Default 0.5):
Classification Report for Threshold = 0.50:
              precision    recall  f1-score   support

           0       0.84      0.89      0.86      1035
           1       0.62      0.53      0.57       374

    accuracy                           0.79      1409
   macro avg       0.73      0.71      0.72      1409
weighted avg       0.78      0.79      0.78      1409
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-55-output-8.png" width="487" height="447" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="model-selection" class="level3">
<h3 data-anchor-id="model-selection">Model Selection</h3>
<p>Considering our primary objective to prioritize Recall (capturing the maximum number of churners), without completely disregarding Precision (to avoid wasting resources):</p>
<p>The Optimized LightGBM with the default cutoff point of 0.50 proves to be the most balanced and effective choice.</p>
<p>It achieves a Recall of 0.79, meaning it correctly identifies 79% of the customers who will actually cancel. This is excellent for proactive retention.</p>
<p>It maintains a Precision of 0.52, which indicates that of the customers the model flags as potential churners, a little over half will actually cancel. This implies a manageable cost of False Positives.</p>
<p>Its F1-Score of 0.63 is the highest among the optimized models, confirming its strong balance.</p>
<p>Its AUPRC (0.6565) and AUC-ROC (0.8428) are the highest, attesting to its overall robustness.</p>
<p>The Optimized SVM is impressive for its potential for an extremely high Recall (reaching 0.88 at lower thresholds), but the drop in Precision would be too steep (below 0.50) to justify its selection for this project. This would only be viable if the cost of a False Positive were absolutely negligible, which is rarely the case in retention strategies.</p>
</section>
<section id="conclusion" class="level3">
<h3 data-anchor-id="conclusion">Conclusion</h3>
<p>Chosen Model: Optimized LightGBM Classifier Treshold: 0.50 (default)</p>
<p>The Optimized LightGBM, using its default cutoff point of 0.50, offers the best balance between detecting customers who will actually cancel (79% Recall) and minimizing unnecessary interventions (52% Precision). This balance is ideal for a business strategy where the priority is to retain customers, ensuring that the majority of potential churners are identified, while simultaneously optimizing the use of retention resources. Its superior performance in AUPRC and AUC-ROC also attests to its overall discriminatory power.</p>
</section>
</section>
</section>
<section id="feature-importance" class="level1">
<h1>Feature Importance</h1>
<p>Feature Importance Analysis seeks to quantify the contribution of each variable (feature) in our dataset to the model’s predictions. In other words, it helps us understand which customer characteristics have the greatest impact on the probability of churn, revealing the “triggers” and “protectors” behind this behavior.</p>
<p>For this analysis, we will employ the SHAP (SHapley Additive exPlanations) methodology. SHAP is an advanced and widely respected technique known for its ability to offer transparent and fair interpretability. Unlike simpler methods, SHAP not only tells us “how important” a feature is, but also:</p>
<ul>
<li><p>The Magnitude of the Impact: How much a feature, on average, pushes the churn prediction up or down.</p></li>
<li><p>The Direction of the Impact: Whether high or low values of a feature tend to increase or decrease the probability of churn.</p></li>
<li><p>Individual Context: How each feature affects the churn prediction for each individual customer, allowing for a detailed understanding.</p></li>
</ul>
<p>Why is this analysis vital for the Business?</p>
<p>Understanding the importance and directionality of features is fundamental for:</p>
<ul>
<li><p>Strategic Prioritization: Directing marketing, sales, and customer service resources to the areas that truly make a difference in retention.</p></li>
<li><p>Developing Focused Actions: Creating retention campaigns, adjusting product/service offerings, or improving aspects of customer service based on concrete evidence.</p></li>
<li><p>Identifying Opportunities: Discovering new insights into the profile of customers who churn and those who remain loyal.</p></li>
</ul>
<p>By the end of this analysis, we will have a clear view of the main drivers of churn, empowering the business to make more informed and proactive decisions to improve the satisfaction and loyalty of our customers.</p>
<section id="functions" class="level6">
<h6 data-anchor-id="functions">Functions:</h6>
<div id="fdb69e97" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_top_importances(df_imp, value_col, top_n<span class="op">=</span><span class="dv">20</span>, title<span class="op">=</span><span class="st">"Feature Importance"</span>):</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    dfp <span class="op">=</span> df_imp.sort_values(value_col, ascending<span class="op">=</span><span class="va">False</span>).head(top_n)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    plt.barh(dfp[<span class="st">"feature"</span>][::<span class="op">-</span><span class="dv">1</span>], dfp[value_col][::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(value_col)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> group_by_parent_feature(feature_names):</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    parents <span class="op">=</span> []</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> f <span class="kw">in</span> feature_names:</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>        parents.append(f.split(<span class="st">'_'</span>, <span class="dv">1</span>)[<span class="dv">0</span>])</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(parents)</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> aggregate_grouped_importances(values, feature_names, agg<span class="op">=</span><span class="st">"sum"</span>):</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>    parents <span class="op">=</span> group_by_parent_feature(feature_names)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({<span class="st">"feature"</span>: feature_names, <span class="st">"value"</span>: values, <span class="st">"parent"</span>: parents})</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> agg <span class="op">==</span> <span class="st">"sum"</span>:</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>        agg_df <span class="op">=</span> (df.assign(value_abs<span class="op">=</span><span class="kw">lambda</span> d: d[<span class="st">"value"</span>].<span class="bu">abs</span>())</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>                    .groupby(<span class="st">"parent"</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">"value_abs"</span>].<span class="bu">sum</span>()</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>                    .rename(columns<span class="op">=</span>{<span class="st">"parent"</span>:<span class="st">"feature"</span>, <span class="st">"value_abs"</span>:<span class="st">"value"</span>}))</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> agg <span class="op">==</span> <span class="st">"mean"</span>:</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>        agg_df <span class="op">=</span> (df.assign(value_abs<span class="op">=</span><span class="kw">lambda</span> d: d[<span class="st">"value"</span>].<span class="bu">abs</span>())</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>                    .groupby(<span class="st">"parent"</span>, as_index<span class="op">=</span><span class="va">False</span>)[<span class="st">"value_abs"</span>].mean()</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>                    .rename(columns<span class="op">=</span>{<span class="st">"parent"</span>:<span class="st">"feature"</span>, <span class="st">"value_abs"</span>:<span class="st">"value"</span>}))</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"agg must be 'sum' or 'mean'"</span>)</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> agg_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="gain" class="level6">
<h6 data-anchor-id="gain">Gain:</h6>
<div id="870d4d7e" class="cell" data-execution_count="57">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># feature names</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>feat_names <span class="op">=</span> X_train.columns</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co"># importance by "gain"</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>lgbm <span class="op">=</span> joblib.load(<span class="st">'best_lgbm_model.pkl'</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>gain_importances <span class="op">=</span> lgbm.booster_.feature_importance(importance_type<span class="op">=</span><span class="st">"gain"</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>imp_gain_df <span class="op">=</span> pd.DataFrame({<span class="st">"feature"</span>: feat_names, <span class="st">"gain"</span>: gain_importances})</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>imp_gain_df <span class="op">=</span> imp_gain_df.sort_values(<span class="st">"gain"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="co"># detailed plot</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>plot_top_importances(imp_gain_df, <span class="st">"gain"</span>, top_n<span class="op">=</span><span class="dv">20</span>, title<span class="op">=</span><span class="st">"LightGBM - Importance (gain)"</span>)</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="co"># GROUPED version by 'parent' variable</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>imp_gain_grouped <span class="op">=</span> aggregate_grouped_importances(gain_importances, feat_names, agg<span class="op">=</span><span class="st">"sum"</span>)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>plot_top_importances(imp_gain_grouped, <span class="st">"value"</span>, top_n<span class="op">=</span><span class="dv">15</span>, title<span class="op">=</span><span class="st">"LightGBM - Aggregated Importance (gain)"</span>)</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>imp_gain_grouped.head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-58-output-1.png" width="758" height="566" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-58-output-2.png" width="758" height="566" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Contract</td>
<td>21974.212258</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Dependents</td>
<td>292.833550</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>DeviceProtection</td>
<td>14.491150</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>InternetService</td>
<td>3850.850205</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MonthlyCharges</td>
<td>4717.019296</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>MultipleLines</td>
<td>346.108218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>OnlineBackup</td>
<td>278.130722</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>OnlineSecurity</td>
<td>635.388637</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>PaperlessBilling</td>
<td>769.884130</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Partner</td>
<td>45.985650</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>PaymentMethod</td>
<td>1814.236586</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>PhoneService</td>
<td>217.981278</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>SeniorCitizen</td>
<td>261.540139</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>StreamingMovies</td>
<td>1429.336064</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>StreamingTV</td>
<td>326.885152</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="permutation-importance" class="level6">
<h6 data-anchor-id="permutation-importance">Permutation Importance:</h6>
<div id="aff94ac5" class="cell" data-execution_count="58">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>perm <span class="op">=</span> permutation_importance(</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    lgbm, X_test, y_test,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    n_repeats<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span>, scoring<span class="op">=</span><span class="st">"roc_auc"</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>imp_perm_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"feature"</span>: feat_names,</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"perm_imp_auc"</span>: perm.importances_mean,</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"perm_imp_std"</span>: perm.importances_std</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>}).sort_values(<span class="st">"perm_imp_auc"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>plot_top_importances(imp_perm_df, <span class="st">"perm_imp_auc"</span>, top_n<span class="op">=</span><span class="dv">20</span>, title<span class="op">=</span><span class="st">"Permutation Importance (AUC)"</span>)</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="co"># GROUPED by 'parent' variable</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>imp_perm_grouped <span class="op">=</span> aggregate_grouped_importances(imp_perm_df[<span class="st">"perm_imp_auc"</span>].values, feat_names, agg<span class="op">=</span><span class="st">"sum"</span>)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>plot_top_importances(imp_perm_grouped, <span class="st">"value"</span>, top_n<span class="op">=</span><span class="dv">15</span>, title<span class="op">=</span><span class="st">"Aggregated Permutation Importance (AUC)"</span>)</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>imp_perm_grouped.head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-59-output-1.png" width="758" height="566" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-59-output-2.png" width="758" height="566" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Contract</td>
<td>0.000119</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Dependents</td>
<td>0.022862</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>DeviceProtection</td>
<td>0.001548</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>InternetService</td>
<td>0.000422</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MonthlyCharges</td>
<td>0.000307</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>MultipleLines</td>
<td>0.003007</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>OnlineBackup</td>
<td>0.002141</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>OnlineSecurity</td>
<td>0.002959</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>PaperlessBilling</td>
<td>0.000470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Partner</td>
<td>0.029104</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>PaymentMethod</td>
<td>0.000749</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>PhoneService</td>
<td>0.004665</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>SeniorCitizen</td>
<td>0.070613</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>StreamingMovies</td>
<td>0.000827</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>StreamingTV</td>
<td>0.001181</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="shap-analysis" class="level6">
<h6 data-anchor-id="shap-analysis">SHAP Analysis:</h6>
<div id="d061984c" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>X_sample <span class="op">=</span> X_test.copy()</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> X_sample.shape[<span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">2000</span>:</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    X_sample <span class="op">=</span> X_sample.sample(<span class="dv">2000</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Explainer for LightGBM</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>lgbm <span class="op">=</span> joblib.load(<span class="st">'best_lgbm_model.pkl'</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(lgbm)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(X_sample)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For binary, shap_values</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>sv <span class="op">=</span> shap_values[<span class="dv">1</span>] <span class="cf">if</span> <span class="bu">isinstance</span>(shap_values, <span class="bu">list</span>) <span class="cf">else</span> shap_values</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.1) Beeswarm (global)</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(sv, X_sample, show<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.2) Importance by mean |SHAP|</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>mean_abs <span class="op">=</span> np.<span class="bu">abs</span>(sv).mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>imp_shap_df <span class="op">=</span> pd.DataFrame({<span class="st">"feature"</span>: X_sample.columns, <span class="st">"mean_abs_shap"</span>: mean_abs})<span class="op">\</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>                 .sort_values(<span class="st">"mean_abs_shap"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>plot_top_importances(imp_shap_df, <span class="st">"mean_abs_shap"</span>, top_n<span class="op">=</span><span class="dv">20</span>, title<span class="op">=</span><span class="st">"SHAP - Mean |impact| (global)"</span>)</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.3) Directionality</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> shap_direction(sv, X):</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>    dirs <span class="op">=</span> []</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, f <span class="kw">in</span> <span class="bu">enumerate</span>(X.columns):</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>        xcol <span class="op">=</span> pd.to_numeric(X[f], errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>        corr <span class="op">=</span> np.corrcoef(xcol.fillna(xcol.mean()), sv[:, i])[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>        dirs.append(corr)</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">"feature"</span>: X.columns, <span class="st">"direction_corr"</span>: dirs})</span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>dir_df <span class="op">=</span> shap_direction(sv, X_sample)</span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>shap_exec_df <span class="op">=</span> (imp_shap_df.merge(dir_df, on<span class="op">=</span><span class="st">"feature"</span>)</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>                            .assign(signal<span class="op">=</span><span class="kw">lambda</span> d: np.where(d[<span class="st">"direction_corr"</span>]<span class="op">&gt;=</span><span class="dv">0</span>, <span class="st">"↑ risk"</span>, <span class="st">"↓ risk"</span>)))</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a><span class="co"># GROUPED by 'parent' for dummies</span></span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>shap_group <span class="op">=</span> aggregate_grouped_importances(imp_shap_df[<span class="st">"mean_abs_shap"</span>].values, imp_shap_df[<span class="st">"feature"</span>].values, agg<span class="op">=</span><span class="st">"sum"</span>)</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>plot_top_importances(shap_group, <span class="st">"value"</span>, top_n<span class="op">=</span><span class="dv">15</span>, title<span class="op">=</span><span class="st">"Aggregated SHAP - Mean |impact|"</span>)</span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>shap_exec_df.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-60-output-1.png" width="759" height="904" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-60-output-2.png" width="758" height="566" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-60-output-3.png" width="758" height="566" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display" data-execution_count="59">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature</th>
<th data-quarto-table-cell-role="th">mean_abs_shap</th>
<th data-quarto-table-cell-role="th">direction_corr</th>
<th data-quarto-table-cell-role="th">signal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Contract_Two year</td>
<td>0.724372</td>
<td>-0.987947</td>
<td>↓ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>tenure</td>
<td>0.497586</td>
<td>-0.862675</td>
<td>↓ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Contract_One year</td>
<td>0.350179</td>
<td>-0.942685</td>
<td>↓ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>InternetService_Fiber optic</td>
<td>0.272144</td>
<td>0.923495</td>
<td>↑ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MonthlyCharges</td>
<td>0.229929</td>
<td>0.774371</td>
<td>↑ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>PaymentMethod_Electronic check</td>
<td>0.196693</td>
<td>0.966441</td>
<td>↑ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>OnlineSecurity</td>
<td>0.123907</td>
<td>-0.937402</td>
<td>↓ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>StreamingMovies</td>
<td>0.121011</td>
<td>0.811060</td>
<td>↑ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>PaperlessBilling</td>
<td>0.119186</td>
<td>0.927893</td>
<td>↑ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>InternetService_No</td>
<td>0.111858</td>
<td>-0.927692</td>
<td>↓ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>TechSupport</td>
<td>0.087674</td>
<td>-0.938758</td>
<td>↓ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>MultipleLines</td>
<td>0.060462</td>
<td>0.796864</td>
<td>↑ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>StreamingTV</td>
<td>0.058288</td>
<td>0.920769</td>
<td>↑ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>Dependents</td>
<td>0.039370</td>
<td>-0.834655</td>
<td>↓ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>PaymentMethod_Mailed check</td>
<td>0.035275</td>
<td>-0.843024</td>
<td>↓ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>SeniorCitizen</td>
<td>0.034952</td>
<td>0.894678</td>
<td>↑ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>OnlineBackup</td>
<td>0.032002</td>
<td>-0.800661</td>
<td>↓ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>PhoneService</td>
<td>0.025272</td>
<td>-0.893882</td>
<td>↓ risk</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>gender</td>
<td>0.012525</td>
<td>0.124737</td>
<td>↑ risk</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>PaymentMethod_Credit card (automatic)</td>
<td>0.010431</td>
<td>-0.083750</td>
<td>↓ risk</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="pdp-partial-dependence-plots" class="level6">
<h6 data-anchor-id="pdp-partial-dependence-plots">PDP (Partial Dependence Plots):</h6>
<div id="c27a5c52" class="cell" data-execution_count="60">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select top 6 by SHAP global metric</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>top6 <span class="op">=</span> imp_shap_df[<span class="st">"feature"</span>].head(<span class="dv">6</span>).tolist()</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> top6:</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    PartialDependenceDisplay.from_estimator(lgbm, X_test, [f], kind<span class="op">=</span><span class="st">"average"</span>)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"PDP – </span><span class="sc">{</span>f<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 576x384 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-61-output-2.png" width="758" height="469" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 576x384 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-61-output-4.png" width="758" height="470" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 576x384 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-61-output-6.png" width="758" height="469" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 576x384 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-61-output-8.png" width="758" height="469" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 576x384 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-61-output-10.png" width="758" height="469" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 576x384 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="ProjetoChurn_files/figure-html/cell-61-output-12.png" width="758" height="469" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="consolidated-ranking" class="level4">
<h4 data-anchor-id="consolidated-ranking">Consolidated Ranking:</h4>
<div id="75a67a1e" class="cell" data-execution_count="61">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># normalize and combine</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>r_gain <span class="op">=</span> imp_gain_df.assign(rank_gain<span class="op">=</span><span class="kw">lambda</span> d: d[<span class="st">"gain"</span>].rank(ascending<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>r_perm <span class="op">=</span> imp_perm_df.assign(rank_perm<span class="op">=</span><span class="kw">lambda</span> d: d[<span class="st">"perm_imp_auc"</span>].rank(ascending<span class="op">=</span><span class="va">False</span>))[[<span class="st">"feature"</span>,<span class="st">"rank_perm"</span>]]</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>r_shap <span class="op">=</span> imp_shap_df.assign(rank_shap<span class="op">=</span><span class="kw">lambda</span> d: d[<span class="st">"mean_abs_shap"</span>].rank(ascending<span class="op">=</span><span class="va">False</span>))[[<span class="st">"feature"</span>,<span class="st">"rank_shap"</span>]]</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>rank_df <span class="op">=</span> (r_gain[[<span class="st">"feature"</span>,<span class="st">"rank_gain"</span>]]</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>           .merge(r_perm, on<span class="op">=</span><span class="st">"feature"</span>, how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>           .merge(r_shap, on<span class="op">=</span><span class="st">"feature"</span>, how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>           .merge(shap_exec_df[[<span class="st">"feature"</span>,<span class="st">"direction_corr"</span>,<span class="st">"signal"</span>]], on<span class="op">=</span><span class="st">"feature"</span>, how<span class="op">=</span><span class="st">"left"</span>))</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>rank_df[<span class="st">"rank_mean"</span>] <span class="op">=</span> rank_df[[<span class="st">"rank_gain"</span>,<span class="st">"rank_perm"</span>,<span class="st">"rank_shap"</span>]].mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>rank_df <span class="op">=</span> rank_df.sort_values(<span class="st">"rank_mean"</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Show consolidated top 15</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>rank_df.head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">feature</th>
<th data-quarto-table-cell-role="th">rank_gain</th>
<th data-quarto-table-cell-role="th">rank_perm</th>
<th data-quarto-table-cell-role="th">rank_shap</th>
<th data-quarto-table-cell-role="th">direction_corr</th>
<th data-quarto-table-cell-role="th">signal</th>
<th data-quarto-table-cell-role="th">rank_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Contract_Two year</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>-0.987947</td>
<td>↓ risk</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>tenure</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>-0.862675</td>
<td>↓ risk</td>
<td>2.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Contract_One year</td>
<td>2.0</td>
<td>3.0</td>
<td>3.0</td>
<td>-0.942685</td>
<td>↓ risk</td>
<td>2.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>InternetService_Fiber optic</td>
<td>5.0</td>
<td>4.0</td>
<td>4.0</td>
<td>0.923495</td>
<td>↑ risk</td>
<td>4.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>MonthlyCharges</td>
<td>4.0</td>
<td>6.0</td>
<td>5.0</td>
<td>0.774371</td>
<td>↑ risk</td>
<td>5.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>PaymentMethod_Electronic check</td>
<td>6.0</td>
<td>7.0</td>
<td>6.0</td>
<td>0.966441</td>
<td>↑ risk</td>
<td>6.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>StreamingMovies</td>
<td>7.0</td>
<td>8.0</td>
<td>8.0</td>
<td>0.811060</td>
<td>↑ risk</td>
<td>7.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>InternetService_No</td>
<td>9.0</td>
<td>5.0</td>
<td>10.0</td>
<td>-0.927692</td>
<td>↓ risk</td>
<td>8.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>PaperlessBilling</td>
<td>8.0</td>
<td>9.0</td>
<td>9.0</td>
<td>0.927893</td>
<td>↑ risk</td>
<td>8.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>OnlineSecurity</td>
<td>10.0</td>
<td>11.0</td>
<td>7.0</td>
<td>-0.937402</td>
<td>↓ risk</td>
<td>9.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>TechSupport</td>
<td>11.0</td>
<td>10.0</td>
<td>11.0</td>
<td>-0.938758</td>
<td>↓ risk</td>
<td>10.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>MultipleLines</td>
<td>12.0</td>
<td>17.0</td>
<td>12.0</td>
<td>0.796864</td>
<td>↑ risk</td>
<td>13.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Dependents</td>
<td>14.0</td>
<td>15.0</td>
<td>14.0</td>
<td>-0.834655</td>
<td>↓ risk</td>
<td>14.333333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>SeniorCitizen</td>
<td>16.0</td>
<td>12.0</td>
<td>16.0</td>
<td>0.894678</td>
<td>↑ risk</td>
<td>14.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>StreamingTV</td>
<td>13.0</td>
<td>21.0</td>
<td>13.0</td>
<td>0.920769</td>
<td>↑ risk</td>
<td>15.666667</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="recommendations-and-business-actions-based-on-insights" class="level1">
<h1>Recommendations and Business Actions Based on Insights:</h1>
<ul>
<li><p>Contract Type – Two-Year Contracts (Contract_Two year): Customers with two-year contracts show a significantly lower risk of churn. Encourage migration to this type of contract through offers and benefits.</p></li>
<li><p>Contract Type – One-Year Contracts (Contract_One year): Customers with one-year contracts also present lower churn risk compared to month-to-month contracts, but higher than two-year contracts. Reinforce the value of renewal and promote the transition to longer-term contracts.</p></li>
<li><p>Tenure: Customers with short tenure are at higher risk. Implement robust onboarding programs and proactive follow-up during the first months to ensure satisfaction and early engagement.</p></li>
<li><p>Internet Service – Fiber Optic (InternetService_Fiber optic): The fact that fiber optic customers show higher churn risk is a red flag. Service quality, support, or perceived cost-benefit for fiber users should be urgently investigated. Potential issues may include performance problems or inadequate pricing in this segment.</p></li>
<li><p>Monthly Charges (MonthlyCharges): Higher monthly charges increase churn risk. Analyze the price ranges where churn is most prevalent. Consider offering bundled packages or renegotiation for customers with high charges, especially when combined with low tenure.</p></li>
<li><p>Payment Method – Electronic Check (PaymentMethod_Electronic check): Customers using electronic checks are at high risk. This may indicate a segment with lower loyalty, financial difficulties, or dissatisfaction. Consider incentives to switch to other payment methods or establish closer monitoring for these customers.</p></li>
<li><p>Online Security (OnlineSecurity): Not having online security services increases churn risk. Promote the importance and benefits of online security offerings.</p></li>
<li><p>Streaming Services (StreamingMovies, StreamingTV): Having streaming services may increase churn risk. This is counterintuitive and may suggest that these services are not adding enough value to retain customers, or that customers seeking such services tend to have a profile more prone to exploring alternatives.</p></li>
</ul>
</section>
<section id="deploy" class="level1">
<h1>Deploy</h1>
<p>Check this model in production by running churn predictions:</p>
<p><a href="https://ds-churn-prediction-ml-deploy-qp3znuqfw4fpwqcv8li3n2.streamlit.app/" target="_blank" rel="noopener noreferrer"> Click here to access </a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>